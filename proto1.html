<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kerala Agri Helper тАФ Final Version</title>
  <style>
    :root{
      --bg-1: #f4f7f6;
      --glass: rgba(255,255,255,0.6);
      --muted: #52525b;
      --accent-1: #14b8a6; /* teal-500 */
      --accent-2: #4f46e5; /* indigo-600 */
      --accent-dark: #0f766e; /* teal-700 */
      --user-bg: #3b82f6; /* blue-500 */
      --user-text: #ffffff;
      --bot-bg: #ffffff;
      --bot-text: #0f172a; /* slate-900 for high contrast */
      --card-shadow: 0 4px 16px rgba(0,0,0,0.05);
      --radius: 12px;
      --font: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    html,body{height:100%;margin:0;font-family:var(--font);background:var(--bg-1);-webkit-font-smoothing:antialiased}
    .launcher { position:fixed; right:20px; bottom:20px; z-index:1400; display:flex; align-items:center; gap:12px; }
    .launcher-label { background:var(--glass); backdrop-filter: blur(8px); padding:10px 16px; border-radius:var(--radius); display:none; box-shadow:var(--card-shadow); align-items:center; gap:10px; border: 1px solid rgba(255,255,255,0.5); }
    .launcher:hover .launcher-label { display:flex; }
    .bubble { width:64px; height:64px; border-radius:50%; background:linear-gradient(135deg, var(--accent-1), var(--accent-2)); display:flex; align-items:center; justify-content:center; box-shadow:0 10px 30px rgba(0,0,0,0.15); cursor:pointer; color:white; transform-origin: right bottom; transition: transform .2s ease-in-out; }
    .bubble:hover{ transform: scale(1.1); }
    .chat-window { position:fixed; right:20px; bottom:96px; width:60vw; max-width:900px; min-width:380px; height:80vh; z-index:1400; border-radius:18px; background: #f9fafb; box-shadow: 0 20px 60px -10px rgba(0,0,0,0.15); overflow:hidden; display:flex; flex-direction:column; transform-origin: right bottom; border:1px solid #e5e7eb; }
    .chat-hidden { display:none; }
    .cw-header { display:flex; align-items:center; gap:14px; padding:12px 20px; background:var(--bot-bg); color: var(--bot-text); border-bottom: 1px solid #e5e7eb;}
    .logo { width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg, var(--accent-1), var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700; color: white; font-size: 18px; }
    .title { font-weight:700; font-size:18px; }
    .subtitle { font-size:13px; opacity:.7; }
    .cw-actions { margin-left:auto; display:flex; gap:8px; align-items:center }
    .lang-pill { padding:6px 12px; border-radius:999px; background: #f3f4f6; color:var(--muted); cursor:pointer; font-weight:600; border:1px solid transparent; transition: all .2s ease; }
    .lang-pill.active { background:var(--accent-1); color:white; font-weight: 700; border-color: var(--accent-dark); }
    .small-btn{ background: #f3f4f6; color:var(--muted); border: 1px solid #e5e7eb; width: 32px; height: 32px; border-radius:50%; cursor:pointer; font-weight:700; display:flex; align-items:center; justify-content:center; }
    .breadcrumb { display:flex; gap:8px; padding:12px 20px; align-items:center; background: #f3f4f6; border-bottom:1px solid #e5e7eb; }
    .crumb { background:white; padding:7px 12px; border-radius:999px; font-weight:600; color:var(--muted); cursor:pointer; border: 1px solid #e5e7eb;}
    .crumb.active { color:var(--accent-2); font-weight: 700; }
    .chat-body { flex:1; padding:24px; overflow:auto; display:flex; flex-direction:column; gap:20px; }
    .msg { max-width:78%; padding:14px 18px; border-radius:var(--radius); line-height:1.6; animation:fadeIn .2s ease both; font-size: 15px; }
    .msg.bot { align-self:flex-start; background:var(--bot-bg); color:var(--bot-text); border:1px solid #e5e7eb; border-left: 4px solid var(--accent-1); box-shadow: var(--card-shadow); }
    .msg.user { align-self:flex-end; background:var(--user-bg); color:var(--user-text); font-weight: 500; }
    .meta { font-size: 14px; color: var(--bot-text); opacity: 0.9; margin-top: 12px; padding-top: 12px; border-top: 1px solid #f3f4f6; line-height: 1.6; }
    .meta b { font-weight: 600; color: #020617; }
    .msg.bot b { font-weight: 700; color: #020617; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }
    .options-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:12px; margin-top:12px }
    .card { background:var(--bot-bg); border-radius:10px; padding:12px; cursor:pointer; border:1px solid #e5e7eb; display:flex; flex-direction:column; gap:4px; transition: all .2s ease; }
    .card:hover { transform:translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.08); border-color: var(--accent-1); }
    .card .title { font-weight:700; color:var(--accent-dark); font-size: 16px; }
    .card .sub { font-size:14px; color:var(--muted); }
    .chat-footer { padding:12px 20px; border-top:1px solid #e5e7eb; display:flex; gap:12px; align-items:center; background: #f9fafb; }
    .input-wrap { flex:1; display:flex; gap:8px; align-items:center; background:var(--bot-bg); padding:4px 4px 4px 16px; border-radius:999px; border: 1px solid #d1d5db; }
    .input-wrap:focus-within { border-color: var(--accent-2); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
    .input-wrap input { flex:1; border:none; outline:none; background:transparent; padding:8px; font-size:15px }
    .send-btn { background:var(--accent-2); color:white; border:none; width: 44px; height: 44px; border-radius:50%; cursor:pointer; font-weight:800; display:flex; align-items:center; justify-content:center; transition: background-color .2s; }
    .send-btn:hover { background: #4338ca; }
    .action-btn { background:white; width: 44px; height: 44px; border-radius:50%; border:1px solid #d1d5db; cursor:pointer; display:flex; align-items:center; justify-content:center;}
    .suggestions { position:absolute; left:0; right:0; bottom:64px; background:white; border-radius:10px; box-shadow:0 12px 30px rgba(0,0,0,0.12); max-height:220px; overflow:auto; z-index:1600; border:1px solid #e5e7eb; }
    .suggestion-item { padding:10px 16px; cursor:pointer; border-bottom:1px solid #f3f4f6; font-weight: 500; }
    .suggestion-item:last-child{ border-bottom:none }
    .suggestion-item:hover { background: #f9fafb; color: var(--accent-2); }
    .note { font-size:13px; color:var(--muted); padding-top: 4px; }
    .chips { display:flex; gap:8px; flex-wrap:wrap }
    .chip { padding:8px 14px; background:var(--bot-bg); border: 1px solid #e5e7eb; border-radius:999px; font-weight:600; cursor:pointer; color:var(--muted); transition: all .2s ease; }
    .chip:hover { background-color: #f3f4f6; border-color: #d1d5db; color: var(--bot-text); }
    @media (max-width:900px){ .chat-window{ right:12px; left:12px; width:calc(100% - 24px); bottom:90px; height: 85vh; } .launcher-label{ display:none } }
  </style>
</head>
<body>

  <div class="launcher" id="launcher"><div class="launcher-label" title="Open Kerala Agri Helper"><div style="font-weight:900;color:#0f172a">Kerala Agri Helper</div></div><div class="bubble" id="openChat" title="Open chat"><svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M12 3C7 3 3 6 3 10.25c0 1.92.9 3.7 2.47 5.06L6 20l4.07-1.95c.94.2 1.92.29 2.93.29 5 0 9-3 9-7.25S17 3 12 3z" fill="white"/></svg></div></div>
  <div class="chat-window chat-hidden" id="chatWindow" role="dialog" aria-label="Kerala Agri Helper Chat">
    <div class="cw-header">
      <div class="logo">KA</div><div><div class="title">Kerala Agri Helper</div><div class="subtitle">Your AI farming assistant</div></div>
      <div class="cw-actions"><div class="lang-pill active" data-lang="en">EN</div><div class="lang-pill" data-lang="ml">р┤ор┤▓р┤пр┤╛р┤│р┤В</div><div class="lang-pill" data-lang="ta">родрооро┐ро┤рпН</div><button class="small-btn" id="closeBtn" title="Close">тЬХ</button></div>
    </div>
    <div class="breadcrumb" id="breadcrumb"></div><div class="chat-body" id="chatBody" aria-live="polite"></div>
    <div class="chat-footer">
      <button class="action-btn" id="restartBtn" title="Restart">ЁЯФД</button>
      <div class="input-wrap autocomplete"><input id="inputBox" placeholder="Ask about crops, soil, weather..." autocomplete="off" /><div class="suggestions" id="suggestions" style="display:none"></div></div>
      <button class="send-btn" id="sendBtn" title="Send"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button>
    </div>
  </div>

<script>
/* ============================ CONFIG ============================ */
const OPENWEATHER_API_KEY = "REPLACE_WITH_OPENWEATHER_API_KEY";

/* ============================ I18N - UI STRINGS (NOW COMPLETE) ============================ */
const I18N = {
  en: {
    welcome: "Namaskaram ЁЯЩП Welcome to your Agri Helper!", startPrompt: "How can I help you today?", use_location: "ЁЯУН Use my current location", enter_location: "ЁЯУЭ Enter city/village name", weather_fetching: "ЁЯФН Fetching weatherтАж", weather_error: "Couldn't fetch weather. Please check the location.", unknown: "Sorry, I can't help with that yet. Please choose an option.", suggestions_label: "ЁЯТб Or try these quick questions:", main_features_label: "ЁЯСЗ Choose a category to begin:", next_steps_label: "тЮбя╕П What's next?", home: "Home", input_placeholder: "Ask about crops, soil, weather...",
    select_crop_prompt: "Let's talk about crops. Which one would you like to evaluate?",
    select_soil_prompt: "Got it. Now, what type of soil are we checking for {crop}?",
    market_trends_prompt: "Let's look at the market. Select a crop to see its seasonal trends.",
    schemes_prompt: "Here are some popular government schemes. Select one to learn more.",
    disease_prompt: "Let's identify a pest or disease. Choose a common issue from the list.",
    select_soil_details_prompt: "Let's explore soil types. Which one would you like details on?",
    enter_city_prompt: "Please type your city or village name and press send.",
    suitability_ok: "{crop} is generally suitable for {soil} soil.", suitability_bad: "тЪая╕П {crop} may face challenges in {soil} soil.", notes_label: "Notes", pests_label: "Common Pests", challenges_label: "Challenges", alternatives_label: "Alternatives",
    weather_suggestion_hot: "ЁЯе╡ High temperature тАФ consider extra irrigation and mulching.", weather_suggestion_cool: "ЁЯе╢ Cool conditions тАФ protect sensitive young crops.", weather_suggestion_rain: "ЁЯМзя╕П Rain is likely тАФ postpone pesticide or fertilizer sprays.", weather_suggestion_normal: "тЬЕ Normal conditions. Good for general farm activities.",
    quick_chips: ['Paddy pests', 'Weather in Thrissur', 'Coconut market price', 'PM-KISAN scheme'],
    suggest_after_weather_title: "Suitable crops for this weather", suggest_after_irrigation_title: "Irrigation Advice", suggest_after_market_title: "See Market Trends",
    suggest_after_scheme_apply_title: "How to apply for subsidy", suggest_after_scheme_office_title: "Find nearest Agri Office",
    suggest_after_market_forecast_title: "Next season forecast", suggest_after_market_sell_title: "Best time to sell",
    suggest_after_disease_fert_title: "Recommended fertilizers", suggest_after_disease_irrigation_title: "Irrigation for recovery",
    response_scheme_apply: "тЬЕ To apply for most schemes, visit your nearest Krishi Bhavan with your land tax receipts, Aadhaar card, and bank passbook. Officers there will guide you.",
    response_scheme_office: "ЁЯПв You can find your nearest Krishi Bhavan by searching online or visiting the Kerala Agriculture Department website. The general helpline is 1800-425-1661.",
    response_market_forecast: "ЁЯУИ While precise forecasting is difficult, prices for seasonal crops typically improve after the monsoon period (Oct-Nov) due to festival demand.",
    response_market_sell: "ЁЯТб The best time to sell is often during major festival seasons like Onam and Vishu when demand is high. Avoid selling immediately at harvest time when supply is high.",
    response_disease_irrigation: "ЁЯТз For plants recovering from fungal diseases, ensure good drainage and avoid over-watering. For pest attacks, ensure the plant is not water-stressed."
  },
  ml: {
    welcome: "р┤ир┤ор┤╕р╡Нр┤Хр┤╛р┤░р┤В ЁЯЩП р┤Ер┤Чр╡Нр┤░р┤┐ р┤╣р╡Жр╡╜р┤кр╡Нр┤кр┤▒р┤┐р┤▓р╡Зр┤Хр╡Нр┤Хр╡Н р┤╕р╡Нр┤╡р┤╛р┤Чр┤др┤В!", startPrompt: "р┤Юр┤╛р╡╗ р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Ж р┤Ор┤Щр╡Нр┤Щр┤ир╡Ж р┤╕р┤╣р┤╛р┤пр┤┐р┤Хр╡Нр┤Хр┤гр┤В?", use_location: "ЁЯУН р┤Ор┤ир╡Нр┤▒р╡Ж р┤╕р╡Нр┤ер┤▓р┤В р┤Йр┤кр┤пр╡Лр┤Чр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х", enter_location: "ЁЯУЭ р┤ир┤Чр┤░р┤В/р┤Чр╡Нр┤░р┤╛р┤ор┤В р┤ир╡╜р┤Хр╡Бр┤Х", weather_fetching: "ЁЯФН р┤Хр┤╛р┤▓р┤╛р┤╡р┤╕р╡Нр┤е р┤ир╡Зр┤Яр╡Бр┤ир╡Нр┤ир╡БтАж", weather_error: "р┤Хр┤╛р┤▓р┤╛р┤╡р┤╕р╡Нр┤е р┤Хр┤гр╡Нр┤Яр╡Жр┤др╡Нр┤др┤╛р┤ир┤╛р┤пр┤┐р┤▓р╡Нр┤▓. р┤╕р╡Нр┤ер┤▓р┤В р┤кр┤░р┤┐р┤╢р╡Лр┤зр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х.", unknown: "р┤Хр╡Нр┤╖р┤ор┤┐р┤Хр╡Нр┤Хр┤гр┤В, р┤Ер┤др┤┐р┤ир╡Н р┤ор┤▒р╡Бр┤кр┤Яр┤┐р┤пр┤┐р┤▓р╡Нр┤▓. р┤Тр┤░р╡Б р┤Ур┤кр╡Нр┤╖р╡╗ р┤др┤┐р┤░р┤Юр╡Нр┤Юр╡Жр┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х.", suggestions_label: "ЁЯТб р┤Ер┤▓р╡Нр┤▓р╡Жр┤Щр╡Нр┤Хр┤┐р╡╜ р┤Зр┤╡ р┤╢р╡Нр┤░р┤ор┤┐р┤Хр╡Нр┤Хр╡Бр┤Х:", main_features_label: "ЁЯСЗ р┤Жр┤░р┤Вр┤нр┤┐р┤Хр╡Нр┤Хр┤╛р╡╗ р┤Тр┤░р╡Б р┤╡р┤┐р┤нр┤╛р┤Чр┤В р┤др┤┐р┤░р┤Юр╡Нр┤Юр╡Жр┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х:", next_steps_label: "тЮбя╕П р┤Ер┤Яр╡Бр┤др╡Нр┤др┤др╡Н р┤Ор┤ир╡Нр┤др╡Н?", home: "р┤╣р╡Лр┤В", input_placeholder: "р┤╡р┤┐р┤│, р┤ор┤гр╡Нр┤гр╡Н, р┤Хр┤╛р┤▓р┤╛р┤╡р┤╕р╡Нр┤е...",
    select_crop_prompt: "р┤╡р┤┐р┤│р┤Хр┤│р╡Жр┤Хр╡Нр┤Хр╡Бр┤▒р┤┐р┤Ър╡Нр┤Ър╡Н р┤╕р┤Вр┤╕р┤╛р┤░р┤┐р┤Хр╡Нр┤Хр┤╛р┤В. р┤Пр┤др┤╛р┤гр╡Н р┤ир┤┐р┤Щр╡Нр┤Щр╡╛ р┤╡р┤┐р┤▓р┤пр┤┐р┤░р╡Бр┤др╡Нр┤др┤╛р╡╗ р┤Жр┤Чр╡Нр┤░р┤╣р┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир┤др╡Н?",
    select_soil_prompt: "р┤╢р┤░р┤┐. р┤Зр┤кр╡Нр┤кр╡Лр╡╛, {crop}-р┤ир┤╛р┤пр┤┐ р┤Пр┤др╡Н р┤др┤░р┤В р┤ор┤гр╡Нр┤гр┤╛р┤гр╡Н р┤кр┤░р┤┐р┤╢р╡Лр┤зр┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир┤др╡Н?",
    market_trends_prompt: "р┤╡р┤┐р┤кр┤гр┤┐ р┤кр┤░р┤┐р┤╢р╡Лр┤зр┤┐р┤Хр╡Нр┤Хр┤╛р┤В. р┤Тр┤░р╡Б р┤╡р┤┐р┤│р┤пр╡Бр┤Яр╡Ж р┤╕р╡Ар┤╕р┤гр╡╜ р┤Яр╡Нр┤░р╡Жр╡╗р┤бр╡Бр┤Хр╡╛ р┤Хр┤╛р┤гр┤╛р╡╗ р┤др┤┐р┤░р┤Юр╡Нр┤Юр╡Жр┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х.",
    schemes_prompt: "р┤кр╡Нр┤░р┤зр┤╛р┤и р┤╕р╡╝р┤Хр╡Нр┤Хр┤╛р╡╝ р┤кр┤жр╡Нр┤зр┤др┤┐р┤Хр╡╛ р┤др┤╛р┤┤р╡Ж р┤ир╡╜р┤Хр╡Бр┤ир╡Нр┤ир╡Б. р┤Хр╡Вр┤Яр╡Бр┤др┤▓р┤▒р┤┐р┤пр┤╛р╡╗ р┤Тр┤ир╡Нр┤ир╡Н р┤др┤┐р┤░р┤Юр╡Нр┤Юр╡Жр┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х.",
    disease_prompt: "р┤Тр┤░р╡Б р┤Хр╡Ар┤Яр┤др╡Нр┤др╡Жр┤пр╡Л р┤░р╡Лр┤Чр┤др╡Нр┤др╡Жр┤пр╡Л р┤Хр┤гр╡Нр┤Яр╡Жр┤др╡Нр┤др┤╛р┤В. р┤кр┤Яр╡Нр┤Яр┤┐р┤Хр┤пр┤┐р╡╜ р┤ир┤┐р┤ир╡Нр┤ир╡Н р┤Тр┤░р╡Б р┤кр╡Кр┤др╡Бр┤╡р┤╛р┤п р┤кр╡Нр┤░р┤╢р╡Нр┤ир┤В р┤др┤┐р┤░р┤Юр╡Нр┤Юр╡Жр┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х.",
    select_soil_details_prompt: "р┤ор┤гр╡Нр┤гр┤┐р┤ир╡Нр┤▒р╡Ж р┤др┤░р┤Щр╡Нр┤Щр╡╛ р┤кр┤░р┤┐р┤╢р╡Лр┤зр┤┐р┤Хр╡Нр┤Хр┤╛р┤В. р┤Пр┤др┤┐р┤ир╡Жр┤Хр╡Нр┤Хр╡Бр┤▒р┤┐р┤Ър╡Нр┤Ър┤╛р┤гр╡Н р┤ир┤┐р┤Щр╡Нр┤Щр╡╛р┤Хр╡Нр┤Хр╡Н р┤╡р┤┐р┤╡р┤░р┤Щр╡Нр┤Щр╡╛ р┤╡р╡Зр┤гр╡Нр┤Яр┤др╡Н?",
    enter_city_prompt: "р┤жр┤пр┤╡р┤╛р┤пр┤┐ р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤ир┤Чр┤░р┤др╡Нр┤др┤┐р┤ир╡Нр┤▒р╡Жр┤пр╡Л р┤Чр╡Нр┤░р┤╛р┤ор┤др╡Нр┤др┤┐р┤ир╡Нр┤▒р╡Жр┤пр╡Л р┤кр╡Зр┤░р╡Н р┤Яр╡Ир┤кр╡Нр┤кр╡Н р┤Ър╡Жр┤пр╡Нр┤др╡Н р┤Ер┤пр┤пр╡Нр┤Хр╡Нр┤Хр╡Бр┤Х.",
    suitability_ok: "{crop}, {soil} р┤ор┤гр╡Нр┤гр┤┐р┤ир╡Н р┤кр╡Кр┤др╡Бр┤╡р╡Ж р┤Ер┤ир╡Бр┤пр╡Лр┤Ьр╡Нр┤пр┤ор┤╛р┤гр╡Н.", suitability_bad: "тЪая╕П {crop}, {soil} р┤ор┤гр╡Нр┤гр┤┐р╡╜ р┤╡р╡Жр┤▓р╡Нр┤▓р╡Бр┤╡р┤┐р┤│р┤┐р┤Хр╡╛ р┤ир╡Зр┤░р┤┐р┤Яр┤╛р┤В.", notes_label: "р┤Хр╡Бр┤▒р┤┐р┤кр╡Нр┤кр╡Бр┤Хр╡╛", pests_label: "р┤╕р┤╛р┤зр┤╛р┤░р┤г р┤Хр╡Ар┤Яр┤Щр╡Нр┤Щр╡╛", challenges_label: "р┤╡р╡Жр┤▓р╡Нр┤▓р╡Бр┤╡р┤┐р┤│р┤┐р┤Хр╡╛", alternatives_label: "р┤мр┤жр╡╜ р┤╡р┤┐р┤│р┤Хр╡╛",
    weather_suggestion_hot: "ЁЯе╡ р┤Йр┤пр╡╝р┤ир╡Нр┤и р┤др┤╛р┤кр┤ир┤┐р┤▓ тАФ р┤Ер┤зр┤┐р┤Х р┤Ьр┤▓р┤╕р╡Зр┤Ър┤ир┤╡р╡Бр┤В р┤кр╡Бр┤др┤пр┤┐р┤Яр┤▓р╡Бр┤В р┤кр┤░р┤┐р┤Чр┤гр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х.", weather_suggestion_cool: "ЁЯе╢ р┤др┤гр╡Бр┤др╡Нр┤д р┤Хр┤╛р┤▓р┤╛р┤╡р┤╕р╡Нр┤е тАФ р┤Зр┤│р┤В р┤╡р┤┐р┤│р┤Хр┤│р╡Ж р┤╕р┤Вр┤░р┤Хр╡Нр┤╖р┤┐р┤Хр╡Нр┤Хр╡Бр┤Х.", weather_suggestion_rain: "ЁЯМзя╕П р┤ор┤┤ р┤╕р┤╛р┤зр╡Нр┤пр┤др┤пр╡Бр┤гр╡Нр┤Яр╡Н тАФ р┤Хр╡Ар┤Яр┤ир┤╛р┤╢р┤┐р┤ир┤┐ р┤кр╡Нр┤░р┤пр╡Лр┤Чр┤В р┤ор┤╛р┤▒р╡Нр┤▒р┤┐р┤╡р┤пр╡Нр┤Хр╡Нр┤Хр╡Бр┤Х.", weather_suggestion_normal: "тЬЕ р┤╕р┤╛р┤зр┤╛р┤░р┤г р┤Хр┤╛р┤▓р┤╛р┤╡р┤╕р╡Нр┤е. р┤Хр╡Гр┤╖р┤┐р┤кр╡Нр┤кр┤гр┤┐р┤Хр╡╛р┤Хр╡Нр┤Хр╡Н р┤ир┤▓р╡Нр┤▓р┤др┤╛р┤гр╡Н.",
    quick_chips: ['р┤ир╡Жр┤▓р╡Нр┤▓р┤┐р┤▓р╡Ж р┤Хр╡Ар┤Яр┤Щр╡Нр┤Щр╡╛', 'р┤др╡Гр┤╢р╡Нр┤╢р╡Вр╡╝ р┤Хр┤╛р┤▓р┤╛р┤╡р┤╕р╡Нр┤е', 'р┤др╡Жр┤Щр╡Нр┤Щр┤┐р┤ир╡Нр┤▒р╡Ж р┤╡р┤┐р┤▓', 'р┤кр┤┐р┤Ор┤В-р┤Хр┤┐р┤╕р┤╛р╡╗'],
    suggest_after_weather_title: "р┤И р┤Хр┤╛р┤▓р┤╛р┤╡р┤╕р╡Нр┤ер┤пр╡Нр┤Хр╡Нр┤Хр╡Н р┤Ер┤ир╡Бр┤пр╡Лр┤Ьр╡Нр┤пр┤ор┤╛р┤п р┤╡р┤┐р┤│р┤Хр╡╛", suggest_after_irrigation_title: "р┤Ьр┤▓р┤╕р╡Зр┤Ър┤и р┤Йр┤кр┤жр╡Зр┤╢р┤В", suggest_after_market_title: "р┤╡р┤┐р┤кр┤гр┤┐ роиро┐ро▓ро╡ро░р┤В р┤Хр┤╛р┤гр╡Бр┤Х",
    suggest_after_scheme_apply_title: "р┤╕р┤мр╡Нр┤╕р┤┐р┤бр┤┐р┤Хр╡Нр┤Хр╡Н р┤Ор┤Щр╡Нр┤Щр┤ир╡Ж р┤Ер┤кр╡Зр┤Хр╡Нр┤╖р┤┐р┤Хр╡Нр┤Хр┤╛р┤В", suggest_after_scheme_office_title: "р┤Ер┤Яр╡Бр┤др╡Нр┤др╡Бр┤│р╡Нр┤│ р┤Хр╡Гр┤╖р┤┐ р┤нр┤╡р╡╗",
    suggest_after_market_forecast_title: "р┤Ер┤Яр╡Бр┤др╡Нр┤д р┤╕р╡Ар┤╕р┤гр┤┐р┤▓р╡Ж р┤кр╡Нр┤░р┤╡р┤Ър┤ир┤В", suggest_after_market_sell_title: "р┤╡р┤┐р╡╜р┤Хр╡Нр┤Хр┤╛р╡╗ р┤кр┤▒р╡Нр┤▒р┤┐р┤п р┤╕р┤ор┤пр┤В",
    suggest_after_disease_fert_title: "р┤╢р╡Бр┤кр┤╛р╡╝р┤╢ р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤ир╡Нр┤и р┤╡р┤│р┤Щр╡Нр┤Щр╡╛", suggest_after_disease_irrigation_title: "р┤░р╡Лр┤Чр┤ор╡Бр┤Хр╡Нр┤др┤┐р┤Хр╡Нр┤Хр╡Н р┤Ьр┤▓р┤╕р╡Зр┤Ър┤ир┤В",
    response_scheme_apply: "тЬЕ р┤кр┤жр╡Нр┤зр┤др┤┐р┤Хр╡╛р┤Хр╡Нр┤Хр╡Н р┤Ер┤кр╡Зр┤Хр╡Нр┤╖р┤┐р┤Хр╡Нр┤Хр┤╛р╡╗, р┤Хр┤░р┤ор┤Яр┤Ър╡Нр┤Ъ р┤░р┤╕р╡Ар┤др╡Н, р┤Жр┤зр┤╛р╡╝, р┤мр┤╛р┤Щр╡Нр┤Хр╡Н р┤кр┤╛р┤╕р╡Нр┤мр╡Бр┤Хр╡Нр┤Хр╡Н р┤Ор┤ир╡Нр┤ир┤┐р┤╡р┤пр╡Бр┤ор┤╛р┤пр┤┐ р┤Ер┤Яр╡Бр┤др╡Нр┤др╡Бр┤│р╡Нр┤│ р┤Хр╡Гр┤╖р┤┐р┤нр┤╡р┤ир┤┐р╡╜ р┤мр┤ир╡Нр┤зр┤кр╡Нр┤кр╡Жр┤Яр╡Бр┤Х.",
    response_scheme_office: "ЁЯПв р┤Ер┤Яр╡Бр┤др╡Нр┤др╡Бр┤│р╡Нр┤│ р┤Хр╡Гр┤╖р┤┐р┤нр┤╡р╡╗ р┤Хр┤гр╡Нр┤Яр╡Жр┤др╡Нр┤др┤╛р╡╗ р┤Ур╡║р┤▓р╡Ир┤ир┤┐р╡╜ р┤др┤┐р┤░р┤пр╡Бр┤Х. р┤кр╡Кр┤др╡Б р┤╣р╡Жр╡╜р┤кр╡Нр┤кр╡Н р┤▓р╡Ир╡╗: 1800-425-1661.",
    response_market_forecast: "ЁЯУИ р┤Хр╡Гр┤др╡Нр┤пр┤ор┤╛р┤п р┤кр╡Нр┤░р┤╡р┤Ър┤ир┤В р┤мр╡Бр┤жр╡Нр┤зр┤┐р┤ор╡Бр┤Яр╡Нр┤Яр┤╛р┤гр╡Жр┤Щр╡Нр┤Хр┤┐р┤▓р╡Бр┤В, р┤Йр┤др╡Нр┤╕р┤╡ р┤╕р╡Ар┤╕р┤гр╡Бр┤Хр┤│р┤┐р╡╜ (р┤Тр┤Хр╡Нр┤Яр╡Лр┤мр╡╝-р┤ир┤╡р┤Вр┤мр╡╝) р┤╡р┤┐р┤│р┤Хр╡╛р┤Хр╡Нр┤Хр╡Н р┤╡р┤┐р┤▓ р┤Хр╡Вр┤Яр┤╛р┤▒р╡Бр┤гр╡Нр┤Яр╡Н.",
    response_market_sell: "ЁЯТб р┤Ур┤гр┤В, р┤╡р┤┐р┤╖р╡Б р┤кр╡Лр┤▓р╡Бр┤│р╡Нр┤│ р┤Йр┤др╡Нр┤╕р┤╡р┤Хр┤╛р┤▓р┤Щр╡Нр┤Щр┤│р┤┐р╡╜ родрпЗро╡рпИ р┤Хр╡Вр┤Яр╡Бр┤ор╡Нр┤кр╡Лр╡╛ р┤╡р┤┐р╡╜р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир┤др┤╛р┤гр╡Н р┤ир┤▓р╡Нр┤▓р┤др╡Н.",
    response_disease_irrigation: "ЁЯТз р┤Хр╡Бр┤ор┤┐р╡╛ р┤░р╡Лр┤Чр┤др╡Нр┤др┤┐р╡╜ р┤ир┤┐р┤ир╡Нр┤ир╡Н р┤Ър╡Жр┤Яр┤┐ р┤╕р╡Бр┤Цр┤В р┤кр╡Нр┤░р┤╛р┤кр┤┐р┤Хр╡Нр┤Хр╡Бр┤ор╡Нр┤кр╡Лр╡╛, р┤ир┤▓р╡Нр┤▓ р┤ир╡Ар╡╝р┤╡р┤╛р╡╝р┤Ър╡Нр┤Ъ р┤Йр┤▒р┤кр╡Нр┤кр┤╛р┤Хр╡Нр┤Хр╡Бр┤Хр┤пр╡Бр┤В р┤Ер┤ор┤┐р┤др┤ор┤╛р┤пр┤┐ р┤ир┤ир┤пр╡Нр┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир┤др╡Н р┤Тр┤┤р┤┐р┤╡р┤╛р┤Хр╡Нр┤Хр╡Бр┤Хр┤пр╡Бр┤В р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х."
  },
  ta: {
    welcome: "ро╡рогроХрпНроХроорпН ЁЯЩП ро╡рпЗро│ро╛рогрпН р┤╕р┤╣р┤╛р┤пр┤┐роХрпНроХрпБ ро╡ро░ро╡рпЗро▒рпНроХро┐ро▒рпЛроорпН!", startPrompt: "роЗройрпНро▒рпБ роиро╛ройрпН роЙроЩрпНроХро│рпБроХрпНроХрпБ роОрокрпНрокроЯро┐ роЙродро╡ роорпБроЯро┐ропрпБроорпН?", use_location: "ЁЯУН роОройрпН роЗро░рпБрокрпНрокро┐роЯродрпНродрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБ", enter_location: "ЁЯУЭ роироХро░роорпН/роХро┐ро░ро╛роороорпН рокрпЖропро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН", weather_fetching: "ЁЯФН ро╡ро╛ройро┐ро▓рпИ рокрпЖро▒рокрпНрокроЯрпБроХро┐ро▒родрпБтАж", weather_error: "ро╡ро╛ройро┐ро▓рпИропрпИрокрпН рокрпЖро▒ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ. роЗроЯродрпНродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН.", unknown: "рооройрпНройро┐роХрпНроХро╡рпБроорпН, рокродро┐ро▓рпН роЗро▓рпНро▓рпИ. роТро░рпБ ро╡ро┐ро░рпБрокрпНрокродрпНродрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН.", suggestions_label: "ЁЯТб роЕро▓рпНро▓родрпБ роЗро╡ро▒рпНро▒рпИ роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН:", main_features_label: "ЁЯСЗ родрпКроЯроЩрпНроХ роТро░рпБ ро╡роХрпИропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН:", next_steps_label: "тЮбя╕П роЕроЯрпБродрпНродрпБ роОройрпНрой?", home: "роорпБроХрокрпНрокрпБ", input_placeholder: "рокропро┐ро░рпНроХро│рпН, роорогрпН, ро╡ро╛ройро┐ро▓рпИ...",
    select_crop_prompt: "рокропро┐ро░рпНроХро│рпИрокрпН рокро▒рпНро▒ро┐ рокрпЗроЪро▓ро╛роорпН. роирпАроЩрпНроХро│рпН роОродрпИ роородро┐рокрпНрокрпАроЯрпБ роЪрпЖропрпНроп ро╡ро┐ро░рпБроорпНрокрпБроХро┐ро▒рпАро░рпНроХро│рпН?",
    select_soil_prompt: "рокрпБро░ро┐роирпНродродрпБ. роЗрокрпНрокрпЛродрпБ, {crop}роХрпНроХрпБ роОроирпНрод ро╡роХрпИ роорогрпНрогрпИ роЪрпЛродро┐роХрпНроХро┐ро▒рпЛроорпН?",
    market_trends_prompt: "роЪроирпНродрпИропрпИрокрпН рокро╛ро░рпНрокрпНрокрпЛроорпН. роТро░рпБ рокропро┐ро░ро┐ройрпН рокро░рпБро╡роХро╛ро▓рокрпН рокрпЛроХрпНроХрпБроХро│рпИроХрпН роХро╛рог роЕродрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН.",
    schemes_prompt: "рокро┐ро░рокро▓рооро╛рой роЕро░роЪро╛роЩрпНроХродрпН родро┐роЯрпНроЯроЩрпНроХро│рпН роЗроЩрпНроХрпЗ. роорпЗро▓рпБроорпН роЕро▒ро┐роп роТройрпНро▒рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН.",
    disease_prompt: "роТро░рпБ рокрпВроЪрпНроЪро┐ роЕро▓рпНро▓родрпБ роирпЛропрпИроХрпН роХрогрпНроЯро▒ро┐ро╡рпЛроорпН. рокроЯрпНроЯро┐ропро▓ро┐ро▓ро┐ро░рпБроирпНродрпБ роТро░рпБ рокрпКродрпБро╡ро╛рой роЪро┐роХрпНроХро▓рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН.",
    select_soil_details_prompt: "роорогрпН ро╡роХрпИроХро│рпИ роЖро░ро╛ропрпНро╡рпЛроорпН. роОродрпИрокрпН рокро▒рпНро▒ро┐роп ро╡ро┐ро╡ро░роЩрпНроХро│рпН роЙроЩрпНроХро│рпБроХрпНроХрпБ ро╡рпЗрогрпНроЯрпБроорпН?",
    enter_city_prompt: "родропро╡рпБроЪрпЖропрпНродрпБ роЙроЩрпНроХро│рпН роироХро░роорпН роЕро▓рпНро▓родрпБ роХро┐ро░ро╛роородрпНродро┐ройрпН рокрпЖропро░рпИродрпН родроЯрпНроЯроЪрпНроЪрпБ роЪрпЖропрпНродрпБ роЕройрпБрокрпНрокро╡рпБроорпН.",
    suitability_ok: "{crop} рокропро┐ро░рпН {soil} роорогрпНрогрпБроХрпНроХрпБ рокрпКродрпБро╡ро╛роХ рокрпКро░рпБродрпНродрооро╛ройродрпБ.", suitability_bad: "тЪая╕П {crop} рокропро┐ро░рпН {soil} роорогрпНрогро┐ро▓рпН роЪро╡ро╛ро▓рпНроХро│рпИ роЪроирпНродро┐роХрпНроХ роирпЗро░ро┐роЯро▓ро╛роорпН.", notes_label: "роХрпБро▒ро┐рокрпНрокрпБроХро│рпН", pests_label: "рокрпКродрпБро╡ро╛рой рокрпВроЪрпНроЪро┐роХро│рпН", challenges_label: "роЪро╡ро╛ро▓рпНроХро│рпН", alternatives_label: "рооро╛ро▒рпНро▒рпБ рокропро┐ро░рпНроХро│рпН",
    weather_suggestion_hot: "ЁЯе╡ роЕродро┐роХ ро╡рпЖрокрпНрокроиро┐ро▓рпИ тАФ роХрпВроЯрпБродро▓рпН роирпАро░рпНрокрпНрокро╛роЪройроорпН рооро▒рпНро▒рпБроорпН родро┤рпИроХрпНроХрпВро│роорпН рокро▒рпНро▒ро┐ рокро░ро┐роЪрпАро▓ро┐роХрпНроХро╡рпБроорпН.", weather_suggestion_cool: "ЁЯе╢ роХрпБро│ро┐ро░рпНроирпНрод роЪрпВро┤ро▓рпН тАФ роЗро│роорпН рокропро┐ро░рпНроХро│рпИрокрпН рокро╛родрпБроХро╛роХрпНроХро╡рпБроорпН.", weather_suggestion_rain: "ЁЯМзя╕П рооро┤рпИ рокрпЖропрпНроп ро╡ро╛ропрпНрокрпНрокрпБро│рпНро│родрпБ тАФ рокрпВроЪрпНроЪро┐роХрпНроХрпКро▓рпНро▓ро┐ родрпЖро│ро┐рокрпНрокродрпИ роТродрпНродро┐ро╡рпИроХрпНроХро╡рпБроорпН.", weather_suggestion_normal: "тЬЕ роЪро╛родро╛ро░рог роиро┐ро▓рпИроорпИроХро│рпН. ро╡ро┐ро╡роЪро╛ропродрпНродро┐ро▒рпНроХрпБ роиро▓рпНро▓родрпБ.",
    quick_chips: ['роирпЖро▓рпН рокрпВроЪрпНроЪро┐роХро│рпН', 'родро┐ро░рпБроЪрпНроЪрпВро░рпН ро╡ро╛ройро┐ро▓рпИ', 'родрпЗроЩрпНроХро╛ропрпН ро╡ро┐ро▓рпИ', 'рокро┐роОроорпН-роХро┐роЪро╛ройрпН родро┐роЯрпНроЯроорпН'],
    suggest_after_weather_title: "роЗроирпНрод ро╡ро╛ройро┐ро▓рпИроХрпНроХрпБ роПро▒рпНро▒ рокропро┐ро░рпНроХро│рпН", suggest_after_irrigation_title: "роирпАро░рпНрокрпНрокро╛роЪрой роЖро▓рпЛроЪройрпИ", suggest_after_market_title: "роЪроирпНродрпИ роиро┐ро▓ро╡ро░роЩрпНроХро│рпИроХрпН роХро╛рогрпНроХ",
    suggest_after_scheme_apply_title: "рооро╛ройро┐ропродрпНродро┐ро▒рпНроХрпБ ро╡ро┐рогрпНрогрокрпНрокро┐рокрпНрокродрпБ роОрокрпНрокроЯро┐", suggest_after_scheme_office_title: "роЕро░рпБроХро┐ро▓рпБро│рпНро│ ро╡рпЗро│ро╛рогрпН роЕро▓рпБро╡ро▓роХроорпН",
    suggest_after_market_forecast_title: "роЕроЯрпБродрпНрод рокро░рпБро╡родрпНродро┐ро▒рпНроХро╛рой роорпБройрпНройро▒ро┐ро╡ро┐рокрпНрокрпБ", suggest_after_market_sell_title: "ро╡ро┐ро▒рпНроХ роЪро┐ро▒роирпНрод роирпЗро░роорпН",
    suggest_after_disease_fert_title: "рокро░ро┐роирпНродрпБро░рпИроХрпНроХрокрпНрокроЯрпНроЯ роЙро░роЩрпНроХро│рпН", suggest_after_disease_irrigation_title: "роорпАроЯрпНрокрпБроХрпНроХрпБ роирпАро░рпНрокрпНрокро╛роЪройроорпН",
    response_scheme_apply: "тЬЕ родро┐роЯрпНроЯроЩрпНроХро│рпБроХрпНроХрпБ ро╡ро┐рогрпНрогрокрпНрокро┐роХрпНроХ, роЙроЩрпНроХро│рпН роиро┐ро▓ ро╡ро░ро┐ ро░роЪрпАродрпБроХро│рпН, роЖродро╛ро░рпН роЕроЯрпНроЯрпИ рооро▒рпНро▒рпБроорпН ро╡роЩрпНроХро┐ рокро╛ро╕рпНрокрпБроХрпН роЖроХро┐ропро╡ро▒рпНро▒рпБроЯройрпН роЕро░рпБроХро┐ро▓рпБро│рпНро│ роХро┐ро░рпБро╖ро┐ рокро╡ройрпИрокрпН рокро╛ро░рпНро╡рпИропро┐роЯро╡рпБроорпН.",
    response_scheme_office: "ЁЯПв роЖройрпНро▓рпИройро┐ро▓рпН родрпЗроЯрпБро╡родройрпН роорпВро▓роорпН роЙроЩрпНроХро│рпН роЕро░рпБроХро┐ро▓рпБро│рпНро│ роХро┐ро░рпБро╖ро┐ рокро╡ройрпИроХрпН роХро╛рогро▓ро╛роорпН. рокрпКродрпБ роЙродро╡ро┐ роОрогрпН: 1800-425-1661.",
    response_market_forecast: "ЁЯУИ родрпБро▓рпНро▓ро┐ропрооро╛рой роорпБройрпНройро▒ро┐ро╡ро┐рокрпНрокрпБ роХроЯро┐ройроорпН роОройрпНро▒ро╛ро▓рпБроорпН, рокрогрпНроЯро┐роХрпИ роХро╛ро▓роЩрпНроХро│ро┐ро▓рпН (роЕроХрпНроЯрпЛрокро░рпН-роиро╡роорпНрокро░рпН) рокро░рпБро╡роХро╛ро▓ рокропро┐ро░рпНроХро│рпБроХрпНроХро╛рой ро╡ро┐ро▓рпИроХро│рпН рокрпКродрпБро╡ро╛роХ роорпЗроорпНрокроЯрпБроорпН.",
    response_market_sell: "ЁЯТб роУрогроорпН рооро▒рпНро▒рпБроорпН ро╡ро┐ро╖рпБ рокрпЛройрпНро▒ роорпБроХрпНроХро┐роп рокрогрпНроЯро┐роХрпИ роХро╛ро▓роЩрпНроХро│ро┐ро▓рпН родрпЗро╡рпИ роЕродро┐роХрооро╛роХ роЗро░рпБроХрпНроХрпБроорпНрокрпЛродрпБ ро╡ро┐ро▒рпНрокройрпИ роЪрпЖропрпНро╡родрпЗ роЪро┐ро▒роирпНрод роирпЗро░роорпН.",
    response_disease_irrigation: "ЁЯТз рокрпВроЮрпНроЪрпИ роирпЛропрпНроХро│ро┐ро▓ро┐ро░рпБроирпНродрпБ роорпАрогрпНроЯрпБ ро╡ро░рпБроорпН родро╛ро╡ро░роЩрпНроХро│рпБроХрпНроХрпБ, роиро▓рпНро▓ ро╡роЯро┐роХро╛ро▓рпН ро╡роЪродро┐ропрпИ роЙро▒рпБродро┐роЪрпЖропрпНродрпБ, роЕродро┐роХрокрпНрокроЯро┐ропро╛рой роирпАро░рпНрокрпНрокро╛роЪройродрпНродрпИродрпН родро╡ро┐ро░рпНроХрпНроХро╡рпБроорпН."
  }
};

/* ============================ TRANSLATED CORE DATA ============================ */
const DATA = {
    en: {
        features: [{k:"crop",t:"ЁЯМ▒ Crop Guidance",s:"Details, suitability"},{k:"soil",t:"ЁЯПЮя╕П Soil Advice",s:"Types & compatibilities"},{k:"weather",t:"ЁЯМжя╕П Weather Info",s:"Live local weather"},{k:"market",t:"ЁЯУИ Market Trends",s:"Seasonal demand"},{k:"schemes",t:"ЁЯУЬ Govt Schemes",s:"For Kerala farmers"},{k:"disease",t:"ЁЯРЫ Pest & Disease",s:"Symptoms & remedies"}],
        crops: {"Paddy":{nutrients:"Requires balanced NPK & high water.",pests:"Stem borer, Blast"},"Coconut":{nutrients:"Needs NPK + micronutrients.",pests:"Rhinoceros beetle, Mites"},"Banana":{nutrients:"High potassium demand.",pests:"Nematodes, Sigatoka"}},
        soils: {"Laterite":{suitable:["Cashew","Coconut"],"challenges":"Low fertility, acidic.","alternatives":"Banana, Pepper"},"Alluvial":{suitable:["Paddy","Banana"],"challenges":"High water table.","alternatives":"Sugarcane, Vegetables"},"Coastal Sandy":{suitable:["Cashew","Coconut"],"challenges":"Poor water retention.","alternatives":"Groundnut"}},
        schemes: [{"title":"PM-KISAN","desc":"Direct income support of тВ╣6000/year to small farmers."},{"title":"Crop Insurance Support","desc":"Kerala state subsidy on premium for crop insurance."},{"title":"Drip Irrigation Subsidy","desc":"Subsidy for adopting drip irrigation to save water."}],
        market_trends: {"Paddy":"Prices often peak during Oct-Nov after harvest.","Coconut":"Demand rises around festival seasons like Onam.","Banana":"Steady demand, with peaks for varieties like Nendran."},
        diseases: {"stem borer":{remedy:"Remove affected parts, use pheromone traps, or apply recommended pesticides."},"blast":{remedy:"Use resistant varieties, ensure proper spacing, and apply fungicides."},"phytophthora":{remedy:"Improve drainage, remove infected plants, apply phosphonate fungicides."}}
    },
    ml: {
        features: [{k:"crop",t:"ЁЯМ▒ р┤╡р┤┐р┤│ р┤ор┤╛р╡╝р┤Чр╡Нр┤Чр┤ир┤┐р╡╝р┤жр╡Нр┤жр╡Зр┤╢р┤В",s:"р┤╡р┤┐р┤╢р┤жр┤╛р┤Вр┤╢р┤Щр╡Нр┤Щр╡╛"},{k:"soil",t:"ЁЯПЮя╕П р┤ор┤гр╡Нр┤гр╡Н р┤Йр┤кр┤жр╡Зр┤╢р┤В",s:"р┤др┤░р┤Щр╡Нр┤Щр╡╛, р┤Ър╡Зр╡╝р┤Ър╡Нр┤Ъ"},{k:"weather",t:"ЁЯМжя╕П р┤Хр┤╛р┤▓р┤╛р┤╡р┤╕р╡Нр┤е",s:"р┤др┤др╡Нр┤╕р┤ор┤п р┤╡р┤┐р┤╡р┤░р┤В"},{k:"market",t:"ЁЯУИ р┤╡р┤┐р┤кр┤гр┤┐ р┤ир┤┐р┤▓р┤╡р┤╛р┤░р┤В",s:"р┤╕р╡Ар┤╕р┤гр╡╜ р┤бр┤┐р┤ор┤╛р╡╗р┤бр╡Н"},{k:"schemes",t:"ЁЯУЬ р┤╕р╡╝р┤Хр╡Нр┤Хр┤╛р╡╝ р┤кр┤жр╡Нр┤зр┤др┤┐р┤Хр╡╛",s:"р┤Хр╡╝р┤╖р┤Хр╡╝р┤Хр╡Нр┤Хр╡Н"},{k:"disease",t:"ЁЯРЫ р┤░р╡Лр┤Чр┤В & р┤Хр╡Ар┤Яр┤В",s:"р┤кр┤░р┤┐р┤╣р┤╛р┤░р┤Щр╡Нр┤Щр╡╛"}],
        crops: {"р┤ир╡Жр┤▓р╡Нр┤▓р╡Н":{nutrients:"р┤╕р┤ир╡Нр┤др╡Бр┤▓р┤┐р┤др┤ор┤╛р┤п NPK-р┤пр╡Бр┤В р┤Йр┤пр╡╝р┤ир╡Нр┤и р┤Ьр┤▓р┤▓р┤нр╡Нр┤пр┤др┤пр╡Бр┤В р┤Жр┤╡р┤╢р╡Нр┤пр┤ор┤╛р┤гр╡Н.",pests:"р┤др┤гр╡Нр┤Яр╡Бр┤др╡Бр┤░р┤кр╡Нр┤кр╡╗, р┤мр╡Нр┤▓р┤╛р┤╕р╡Нр┤▒р╡Нр┤▒р╡Н"},"р┤др╡Жр┤Щр╡Нр┤Щр╡Н":{nutrients:"NPK-р┤пр╡Бр┤В р┤╕р╡Вр┤Хр╡Нр┤╖р╡Нр┤о р┤кр╡Лр┤╖р┤Хр┤Щр╡Нр┤Щр┤│р╡Бр┤В р┤Жр┤╡р┤╢р╡Нр┤пр┤ор┤╛р┤гр╡Н.",pests:"р┤Хр╡Кр┤ор╡Нр┤кр╡╗р┤Ър╡Жр┤▓р╡Нр┤▓р┤┐, р┤ор┤гр╡Нр┤бр┤░р┤┐"},"р┤╡р┤╛р┤┤":{nutrients:"р┤Йр┤пр╡╝р┤ир╡Нр┤и р┤кр╡Кр┤Яр╡Нр┤Яр┤╛р┤╕р╡Нр┤пр┤В р┤Жр┤╡р┤╢р╡Нр┤пр┤ор┤╛р┤гр╡Н.",pests:"р┤ир┤┐р┤ор┤╛р┤╡р┤┐р┤░р┤Хр╡╛, р┤╕р┤┐р┤Чр┤╛р┤Яр╡Нр┤Яр╡Лр┤Хр╡Нр┤Х"}},
        soils: {"р┤Ър╡Жр┤Щр╡Нр┤Хр╡╜":{suitable:["р┤Хр┤╢р╡Бр┤╡р┤гр╡Нр┤Яр┤┐","р┤др╡Жр┤Щр╡Нр┤Щр╡Н"],"challenges":"р┤╡р┤│р┤Хр╡Нр┤Хр╡Вр┤▒р╡Н р┤Хр╡Бр┤▒р┤╡р╡Н, р┤Ер┤ор╡Нр┤▓р┤др╡Нр┤╡р┤В.","alternatives":"р┤╡р┤╛р┤┤, р┤Хр╡Бр┤░р╡Бр┤ор╡Бр┤│р┤Хр╡Н"},"р┤Ор┤Хр╡Нр┤Хр╡╜":{suitable:["р┤ир╡Жр┤▓р╡Нр┤▓р╡Н","р┤╡р┤╛р┤┤"],"challenges":"р┤Йр┤пр╡╝р┤ир╡Нр┤и р┤Ьр┤▓р┤ир┤┐р┤░р┤кр╡Нр┤кр╡Н.","alternatives":"р┤Хр┤░р┤┐р┤ор╡Нр┤кр╡Н, р┤кр┤Ър╡Нр┤Ър┤Хр╡Нр┤Хр┤▒р┤┐р┤Хр╡╛"},"р┤др╡Ар┤░р┤жр╡Зр┤╢ р┤ор┤гр╡╜":{suitable:["р┤Хр┤╢р╡Бр┤╡р┤гр╡Нр┤Яр┤┐","р┤др╡Жр┤Щр╡Нр┤Щр╡Н"],"challenges":"р┤Ьр┤▓р┤В р┤кр┤┐р┤Яр┤┐р┤Ър╡Нр┤Ър╡Бр┤ир┤┐р╡╝р┤др╡Нр┤др┤╛р┤ир╡Бр┤│р╡Нр┤│ р┤Хр┤┤р┤┐р┤╡р╡Н р┤Хр╡Бр┤▒р┤╡р╡Н.","alternatives":"р┤ир┤┐р┤▓р┤Хр╡Нр┤Хр┤Яр┤▓"}},
        schemes: [{"title":"р┤кр┤┐р┤Ор┤В-р┤Хр┤┐р┤╕р┤╛р╡╗","desc":"р┤Ър╡Жр┤▒р╡Бр┤Хр┤┐р┤Я р┤Хр╡╝р┤╖р┤Хр╡╝р┤Хр╡Нр┤Хр╡Н р┤╡р╡╝р┤╖р┤В тВ╣6000 р┤ир╡Зр┤░р┤┐р┤Яр╡Нр┤Яр╡Н р┤Ер┤Хр╡Нр┤Хр╡Чр┤гр╡Нр┤Яр┤┐р╡╜."},{"title":"р┤╡р┤┐р┤│ р┤Зр╡╗р┤╖р╡Бр┤▒р╡╗р┤╕р╡Н","desc":"р┤╡р┤┐р┤│ р┤Зр╡╗р┤╖р╡Бр┤▒р╡╗р┤╕р╡Н р┤кр╡Нр┤░р╡Ар┤ор┤┐р┤пр┤др╡Нр┤др┤┐р╡╜ р┤Хр╡Зр┤░р┤│ р┤╕р╡╝р┤Хр╡Нр┤Хр┤╛р╡╝ р┤ир╡╜р┤Хр╡Бр┤ир╡Нр┤и р┤╕р┤мр╡Нр┤╕р┤┐р┤бр┤┐."},{"title":"р┤др╡Бр┤│р╡Нр┤│р┤┐р┤ир┤и р┤╕р┤мр╡Нр┤╕р┤┐р┤бр┤┐","desc":"р┤Ьр┤▓р┤В р┤▓р┤╛р┤нр┤┐р┤Хр╡Нр┤Хр┤╛р╡╗ р┤др╡Бр┤│р╡Нр┤│р┤┐р┤ир┤и р┤╕р╡Нр┤ер┤╛р┤кр┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир┤др┤┐р┤ир╡Бр┤│р╡Нр┤│ р┤╕р┤мр╡Нр┤╕р┤┐р┤бр┤┐."}],
        market_trends: {"р┤ир╡Жр┤▓р╡Нр┤▓р╡Н":"р┤╡р┤┐р┤│р┤╡р╡Жр┤Яр╡Бр┤кр╡Нр┤кр┤┐р┤ир╡Н р┤╢р╡Зр┤╖р┤В р┤Тр┤Хр╡Нр┤Яр╡Лр┤мр╡╝-р┤ир┤╡р┤Вр┤мр╡╝ р┤ор┤╛р┤╕р┤Щр╡Нр┤Щр┤│р┤┐р╡╜ р┤╡р┤┐р┤▓ р┤╡р╡╝р┤зр┤┐р┤Хр╡Нр┤Хр┤╛р┤▒р╡Бр┤гр╡Нр┤Яр╡Н.","р┤др╡Жр┤Щр╡Нр┤Щр╡Н":"р┤Ур┤гр┤В р┤кр╡Лр┤▓р╡Бр┤│р╡Нр┤│ р┤Жр┤Шр╡Лр┤╖р┤Хр┤╛р┤▓р┤Щр╡Нр┤Щр┤│р┤┐р╡╜ р┤Жр┤╡р┤╢р╡Нр┤пр┤В р┤╡р╡╝р┤зр┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир╡Б.","р┤╡р┤╛р┤┤":"р┤╕р╡Нр┤ер┤┐р┤░р┤ор┤╛р┤п р┤бр┤┐р┤ор┤╛р╡╗р┤бр╡Н, р┤ир╡Зр┤ир╡Нр┤др╡Нр┤░р╡╗ р┤кр╡Лр┤▓р╡Бр┤│р╡Нр┤│ р┤Зр┤ир┤Щр╡Нр┤Щр╡╛р┤Хр╡Нр┤Хр╡Н р┤╡р┤┐р┤▓ р┤Хр╡Вр┤Яр╡Бр┤др╡╜."},
        diseases: {"р┤др┤гр╡Нр┤Яр╡Бр┤др╡Бр┤░р┤кр╡Нр┤кр╡╗":{remedy:"р┤░р╡Лр┤Чр┤мр┤╛р┤зр┤┐р┤др┤ор┤╛р┤п р┤нр┤╛р┤Чр┤Щр╡Нр┤Щр╡╛ р┤ир╡Ар┤Хр╡Нр┤Хр┤В р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х, р┤лр┤┐р┤▒р┤ор╡Лр╡║ р┤Хр╡Жр┤гр┤┐р┤Хр╡╛ р┤Йр┤кр┤пр╡Лр┤Чр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х."},"р┤мр╡Нр┤▓р┤╛р┤╕р╡Нр┤▒р╡Нр┤▒р╡Н":{remedy:"р┤кр╡Нр┤░р┤др┤┐р┤░р╡Лр┤зр┤╢р╡Зр┤╖р┤┐р┤пр╡Бр┤│р╡Нр┤│ р┤Зр┤ир┤Щр╡Нр┤Щр╡╛ р┤Йр┤кр┤пр╡Лр┤Чр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х, р┤╢р┤░р┤┐р┤пр┤╛р┤п р┤Ер┤Хр┤▓р┤В р┤кр┤╛р┤▓р┤┐р┤Хр╡Нр┤Хр╡Бр┤Х."},"р┤жр╡Нр┤░р╡Бр┤др┤╡р┤╛р┤Яр╡Нр┤Яр┤В":{remedy:"р┤ир╡Ар╡╝р┤╡р┤╛р╡╝р┤Ър╡Нр┤Ъ р┤ор╡Жр┤Ър╡Нр┤Ър┤кр╡Нр┤кр╡Жр┤Яр╡Бр┤др╡Нр┤др╡Бр┤Х, р┤░р╡Лр┤Чр┤мр┤╛р┤зр┤┐р┤др┤ор┤╛р┤п р┤Ър╡Жр┤Яр┤┐р┤Хр╡╛ р┤ир┤╢р┤┐р┤кр╡Нр┤кр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х."}}
    },
    ta: {
        features: [{k:"crop",t:"ЁЯМ▒ рокропро┐ро░рпН ро╡ро┤ро┐роХро╛роЯрпНроЯро┐",s:"ро╡ро┐ро╡ро░роЩрпНроХро│рпН"},{k:"soil",t:"ЁЯПЮя╕П роорогрпН роЖро▓рпЛроЪройрпИ",s:"ро╡роХрпИроХро│рпН"},{k:"weather",t:"ЁЯМжя╕П ро╡ро╛ройро┐ро▓рпИ",s:"роЙро│рпНро│рпВро░рпН родроХро╡ро▓рпН"},{k:"market",t:"ЁЯУИ роЪроирпНродрпИ роиро┐ро▓ро╡ро░роорпН",s:"рокро░рпБро╡роХро╛ро▓ родрпЗро╡рпИ"},{k:"schemes",t:"ЁЯУЬ роЕро░роЪрпБ родро┐роЯрпНроЯроЩрпНроХро│рпН",s:"ро╡ро┐ро╡роЪро╛ропро┐роХро│рпБроХрпНроХрпБ"},{k:"disease",t:"ЁЯРЫ роирпЛропрпН & рокрпВроЪрпНроЪро┐",s:"родрпАро░рпНро╡рпБроХро│рпН"}],
        crops: {"роирпЖро▓рпН":{nutrients:"роЪроороЪрпНроЪрпАро░рпН NPK рооро▒рпНро▒рпБроорпН роЕродро┐роХ роирпАро░рпН родрпЗро╡рпИ.",pests:"родрогрпНроЯрпБ родрпБро│рпИрокрпНрокро╛ройрпН, роХрпБро▓рпИроирпЛропрпН"},"родрпЖройрпНройрпИ":{nutrients:"NPK рооро▒рпНро▒рпБроорпН роирпБрогрпНрогрпВроЯрпНроЯроЪрпН роЪродрпНродрпБроХрпНроХро│рпН родрпЗро╡рпИ.",pests:"роХро╛рогрпНроЯро╛рооро┐ро░рпБроХ ро╡рогрпНроЯрпБ, роЪро┐ро▓роирпНродро┐роХро│рпН"},"ро╡ро╛ро┤рпИ":{nutrients:"роЕродро┐роХ рокрпКроЯрпНроЯро╛роЪро┐ропроорпН родрпЗро╡рпИ.",pests:"роирпВро▒рпНрокрпБро┤рпБроХрпНроХро│рпН, роЪро┐роХроЯрпЛроХро╛"}},
        soils: {"роЪрпЖроорпНроорогрпН":{suitable:["роорпБроирпНродро┐ро░ро┐","родрпЖройрпНройрпИ"],"challenges":"роХрпБро▒рпИроирпНрод ро╡ро│роорпН, роЕрооро┐ро▓родрпНродройрпНроорпИ.","alternatives":"ро╡ро╛ро┤рпИ, рооро┐ро│роХрпБ"},"ро╡рогрпНроЯро▓рпН":{suitable:["роирпЖро▓рпН","ро╡ро╛ро┤рпИ"],"challenges":"роЙропро░рпНроирпНрод роиро┐ро▓родрпНродроЯро┐ роирпАро░рпН.","alternatives":"роХро░рпБроорпНрокрпБ, роХро╛ропрпНроХро▒ро┐роХро│рпН"},"роХроЯро▓рпЛро░ роорогро▓рпН":{suitable:["роорпБроирпНродро┐ро░ро┐","родрпЖройрпНройрпИ"],"challenges":"роХрпБро▒рпИроирпНрод роирпАро░рпН родрпЗроХрпНроХрпБроорпН родро┐ро▒ройрпН.","alternatives":"роиро┐ро▓роХрпНроХроЯро▓рпИ"}},
        schemes: [{"title":"рокро┐роОроорпН-роХро┐роЪро╛ройрпН","desc":"роЪро┐ро▒рпБ ро╡ро┐ро╡роЪро╛ропро┐роХро│рпБроХрпНроХрпБ роЖрогрпНроЯрпБроХрпНроХрпБ тВ╣6000 роирпЗро░роЯро┐ ро╡ро░рпБрооро╛рой роЖродро░ро╡рпБ."},{"title":"рокропро┐ро░рпН роХро╛рокрпНрокрпАроЯрпНроЯрпБ роЖродро░ро╡рпБ","desc":"рокропро┐ро░рпН роХро╛рокрпНрокрпАроЯрпНроЯрпБроХрпНроХро╛рой рокро┐ро░рпАрооро┐ропродрпНродро┐ро▓рпН роХрпЗро░ро│ роЕро░роЪро┐ройрпН рооро╛ройро┐ропроорпН."},{"title":"роЪрпКроЯрпНроЯрпБ роирпАро░рпН рокро╛роЪрой рооро╛ройро┐ропроорпН","desc":"роирпАро░рпИ роЪрпЗрооро┐роХрпНроХ роЪрпКроЯрпНроЯрпБ роирпАро░рпН рокро╛роЪройродрпНродрпИ роЕроорпИрокрпНрокродро▒рпНроХро╛рой рооро╛ройро┐ропроорпН."}],
        market_trends: {"роирпЖро▓рпН":"роЕро▒рпБро╡роЯрпИроХрпНроХрпБрокрпН рокро┐ро▒роХрпБ роЕроХрпНроЯрпЛрокро░рпН-роиро╡роорпНрокро░рпН рооро╛родроЩрпНроХро│ро┐ро▓рпН ро╡ро┐ро▓рпИ роЙроЪрпНроЪродрпНродрпИ роЕроЯрпИроХро┐ро▒родрпБ.","родрпЖройрпНройрпИ":"роУрогроорпН рокрпЛройрпНро▒ рокрогрпНроЯро┐роХрпИ роХро╛ро▓роЩрпНроХро│ро┐ро▓рпН родрпЗро╡рпИ роЕродро┐роХро░ро┐роХрпНроХро┐ро▒родрпБ.","ро╡ро╛ро┤рпИ":"роиро┐ро▓рпИропро╛рой родрпЗро╡рпИ, роирпЗроирпНродро┐ро░ройрпН рокрпЛройрпНро▒ ро╡роХрпИроХро│рпБроХрпНроХрпБ роЙроЪрпНроЪроорпН."},
        diseases: {"родрогрпНроЯрпБ родрпБро│рпИрокрпНрокро╛ройрпН":{remedy:"рокро╛родро┐роХрпНроХрокрпНрокроЯрпНроЯ рокроХрпБродро┐роХро│рпИ роЕроХро▒рпНро▒ро╡рпБроорпН, роЗройроХрпНроХро╡ро░рпНроЪрпНроЪро┐рокрпН рокрпКро▒ро┐роХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН."},"роХрпБро▓рпИроирпЛропрпН":{remedy:"роирпЛропрпН роОродро┐ро░рпНрокрпНрокрпБродрпН родро┐ро▒ройрпН роХрпКрогрпНроЯ ро░роХроЩрпНроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН, роЪро░ро┐ропро╛рой роЗроЯрпИро╡рпЖро│ро┐ропрпИ роЙро▒рпБродро┐ роЪрпЖропрпНропро╡рпБроорпН."},"рокрпИроЯрпНроЯрпЛрокрпНродрпЛро░ро╛":{remedy:"ро╡роЯро┐роХро╛ро▓рпН ро╡роЪродро┐ропрпИ роорпЗроорпНрокроЯрпБродрпНродро╡рпБроорпН, рокро╛родро┐роХрпНроХрокрпНрокроЯрпНроЯ роЪрпЖроЯро┐роХро│рпИ роЕроХро▒рпНро▒ро╡рпБроорпН."}}
    }
};

/* ============================ State & DOM refs ============================ */
let LANG = 'en'; let FLOW = [];
const chatWindow = document.getElementById('chatWindow'), openChat = document.getElementById('openChat'), closeBtn = document.getElementById('closeBtn'), chatBody = document.getElementById('chatBody'), breadcrumb = document.getElementById('breadcrumb'), inputBox = document.getElementById('inputBox'), sendBtn = document.getElementById('sendBtn'), suggestionsBox = document.getElementById('suggestions'), restartBtn = document.getElementById('restartBtn'), langPills = document.querySelectorAll('.lang-pill');

/* ============================ Utilities & Rendering ============================ */
function _t(key, r={}) { let s=I18N[LANG][key]||I18N.en[key]||`[${key}]`; for(const p in r){s=s.replace(`{${p}}`,r[p]);} return s; }
function escapeHtml(s) { return s.replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function clearChat() { chatBody.innerHTML=''; }
function addUser(t) { const d=document.createElement('div');d.className='msg user';d.innerHTML=`<div style="font-weight:500">${escapeHtml(t)}</div>`;chatBody.appendChild(d);chatBody.scrollTop=chatBody.scrollHeight; }
function addBot(h, m=null) { const d=document.createElement('div');d.className='msg bot';d.innerHTML=h+(m?`<div class="meta">${m}</div>`:'');chatBody.appendChild(d);chatBody.scrollTop=chatBody.scrollHeight; }
function addOptions(items, onSelect, note=null) {
  const wrapper=document.createElement('div');wrapper.className='msg bot';
  let inner=note?`<div style="font-weight:700;margin-bottom:12px;color:var(--bot-text);">${note}</div>`:'';
  inner+='<div class="options-grid">';
  items.forEach(it=>{ inner+=`<div class="card" data-key="${escapeHtml(it.k)}"><div class="title">${escapeHtml(it.t)}</div><div class="sub">${escapeHtml(it.s||'')}</div></div>`; });
  inner+='</div>';wrapper.innerHTML=inner;chatBody.appendChild(wrapper);chatBody.scrollTop=chatBody.scrollHeight;
  wrapper.querySelectorAll('.card').forEach(card=>{ card.addEventListener('click',()=>{ const k=card.getAttribute('data-key');onSelect(k);wrapper.querySelectorAll('.card').forEach(c=>c.style.opacity=0.5);card.style.opacity=1;card.style.borderColor='var(--accent-2)';}); });
}
function updateBreadcrumb() { breadcrumb.innerHTML='';const h=document.createElement('div');h.className='crumb active';h.textContent=_t('home');h.addEventListener('click',()=>resetFlow());breadcrumb.appendChild(h);FLOW.forEach(f=>{const c=document.createElement('div');c.className='crumb';c.textContent=f.label;breadcrumb.appendChild(c);}); }

/* ============================ Core Flow & Startup ============================ */
function pushFlow(s, k, l, d={}) { FLOW.push({step:s,key:k,label:l,data:d});updateBreadcrumb(); }
openChat.addEventListener('click', ()=>{chatWindow.classList.remove('chat-hidden');resetFlow(true);});
closeBtn.addEventListener('click', ()=>chatWindow.classList.add('chat-hidden'));
langPills.forEach(p=>{ p.addEventListener('click', ()=>{ langPills.forEach(n=>n.classList.remove('active'));p.classList.add('active');LANG=p.getAttribute('data-lang');resetFlow();}); });

function resetFlow(init=false) {
  FLOW=[];updateBreadcrumb();clearChat();inputBox.placeholder=_t('input_placeholder');
  addBot(`<b>${_t('welcome')}</b><div class="note">${_t('startPrompt')}</div>`);
  addOptions(DATA[LANG].features, featureSelected, _t('main_features_label'));
  const chips=_t('quick_chips');
  const chipWrap=document.createElement('div');chipWrap.className='msg bot';
  let chipHtml=`<div style="font-weight:700;margin-bottom:12px">${_t('suggestions_label')}</div><div class="chips">`;
  chips.forEach(ch=>chipHtml+=`<div class="chip">${escapeHtml(ch)}</div>`);
  chipWrap.innerHTML=chipHtml+'</div>';chatBody.appendChild(chipWrap);
  chipWrap.querySelectorAll('.chip').forEach(ch=>{ ch.addEventListener('click',()=>{ inputBox.value=ch.textContent;inputBox.focus();handleSend();}); });
  if(!init){inputBox.value='';inputBox.focus();}
}

/* ============================ Feature Flows ============================ */
function featureSelected(key) {
  const feat=DATA[LANG].features.find(f=>f.k===key); const label=feat?feat.t:key;
  addUser(label); pushFlow('feature', key, label);
  const flows={crop:startCropFlow, soil:startSoilFlow, weather:startWeatherFlow, market:startMarketFlow, schemes:startSchemesFlow, disease:startDiseaseFlow};
  (flows[key]||(()=>addBot(_t('unknown'))))();
}
function addFollowUpOptions() {
    const followUps = DATA[LANG].features.filter(f => ['weather', 'market', 'schemes'].includes(f.k));
    addOptions(followUps, key => featureSelected(key), _t('next_steps_label'));
}
function startCropFlow() {
  addBot(`<b>${_t('select_crop_prompt')}</b>`);
  const crops=Object.keys(DATA[LANG].crops).map(k=>({k, t:k, s:DATA[LANG].crops[k].pests}));
  addOptions(crops, selected=>{ addUser(selected);pushFlow('crop',selected,selected,{crop:selected});askSoilForCrop(selected); });
}
function askSoilForCrop(crop) {
  addBot(`<b>${_t('select_soil_prompt',{crop})}</b>`);
  const soils=Object.keys(DATA[LANG].soils).map(s=>({k:s,t:s,s:DATA[LANG].soils[s].suitable.join(', ')}));
  addOptions(soils, soil=>{ addUser(soil);pushFlow('soil',soil,soil,{crop,soil});analyzeCropSoil(crop,soil); });
}
function analyzeCropSoil(crop, soil) {
  const cropData = DATA[LANG].crops[crop]; const soilData = DATA[LANG].soils[soil];
  if (soilData.suitable.includes(crop)) {
    addBot(`тЬЕ <b>${_t('suitability_ok',{crop,soil})}</b>`, `<b>${_t('notes_label')}:</b> ${cropData.nutrients}<br><b>${_t('pests_label')}:</b> ${cropData.pests}`);
  } else {
    addBot(`тЪая╕П <b>${_t('suitability_bad',{crop,soil})}</b>`, `<b>${_t('challenges_label')}:</b> ${soilData.challenges}<br><b>${_t('alternatives_label')}:</b> ${soilData.alternatives}`);
  }
  addFollowUpOptions();
}
function startSoilFlow() {
  addBot(`<b>${_t('select_soil_details_prompt')}</b>`);
  const soils=Object.keys(DATA[LANG].soils).map(s=>({k:s,t:s,s:DATA[LANG].soils[s].suitable.join(', ')}));
  addOptions(soils, soil=>{ addUser(soil);const info=DATA[LANG].soils[soil];addBot(`<b>${soil}</b>`, `<b>${_t('challenges_label')}:</b> ${info.challenges}<br><b>${_t('alternatives_label')}:</b> ${info.alternatives}`);addFollowUpOptions(); });
}
function startMarketFlow() {
  addBot(`<b>${_t('market_trends_prompt')}</b>`);
  const items=Object.keys(DATA[LANG].market_trends).map(k=>({k,t:k}));
  addOptions(items, sel=>{
    addUser(sel); addBot(`<b>${sel}</b>: ${DATA[LANG].market_trends[sel]}`);
    addOptions([ { k: 'forecast', t: `ЁЯУИ ${_t('suggest_after_market_forecast_title')}` }, { k: 'sell', t: `ЁЯТб ${_t('suggest_after_market_sell_title')}` } ], key => { addUser(_t(`suggest_after_market_${key}_title`)); addBot(_t(`response_market_${key}`)); }, _t('next_steps_label'));
  });
}
function startSchemesFlow() {
  addBot(`<b>${_t('schemes_prompt')}</b>`);
  const items=DATA[LANG].schemes.map(s=>({k:s.title,t:s.title,s:s.desc}));
  addOptions(items, sel=>{
    addUser(sel); const scheme=DATA[LANG].schemes.find(s=>s.title===sel); addBot(`<b>${scheme.title}</b>: ${scheme.desc}`);
    addOptions([ { k: 'apply', t: `ЁЯТ░ ${_t('suggest_after_scheme_apply_title')}` }, { k: 'office', t: `ЁЯУН ${_t('suggest_after_scheme_office_title')}` } ], key => { addUser(_t(`suggest_after_scheme_${key}_title`)); addBot(_t(`response_scheme_${key}`)); }, _t('next_steps_label'));
  });
}
function startDiseaseFlow() {
  addBot(`<b>${_t('disease_prompt')}</b>`);
  const items=Object.keys(DATA[LANG].diseases).map(k=>({k,t:k}));
  addOptions(items, sel=>{
    addUser(sel); addBot(`<b>${sel}</b>: ${DATA[LANG].diseases[sel].remedy}`);
    addOptions([ { k: 'fert', t: `ЁЯз┤ ${_t('suggest_after_disease_fert_title')}` }, { k: 'irrigation', t: `ЁЯТз ${_t('suggest_after_disease_irrigation_title')}` }, { k: 'market', t: `ЁЯУИ ${_t('suggest_after_market_title')}` } ], key => {
        if (key === 'market') { addUser(`ЁЯУИ ${_t('suggest_after_market_title')}`); startMarketFlow(); }
        else if (key === 'fert') { addUser(`ЁЯз┤ ${_t('suggest_after_disease_fert_title')}`); addFollowUpOptions(); }
        else { addUser(`ЁЯТз ${_t('suggest_after_disease_irrigation_title')}`); addBot(_t('response_disease_irrigation')); }
    }, _t('next_steps_label'));
  });
}

/* ============================ Weather Flow ============================ */
function startWeatherFlow() {
  addBot(`<b>${_t('weather_fetching')}</b>`);
  addOptions([{k:'use_loc',t:_t('use_location')},{k:'enter_loc',t:_t('enter_location')}],act=>{
    if(act==='use_loc'){addUser(_t('use_location'));getLocationAndWeather();}
    else{addUser(_t('enter_location'));addBot("тЬНя╕П "+_t('enter_city_prompt'));pushFlow('await-weather','manual','Awaiting location');}
  });
}
function getLocationAndWeather() {
  if(!navigator.geolocation){addBot(`ЁЯЪл ${_t('weather_error')}`);return;}
  addBot(`ЁЯЫ░я╕П ${_t('locating')}`);
  navigator.geolocation.getCurrentPosition(async pos=>{ const data=await fetchWeather(pos.coords.latitude,pos.coords.longitude);if(data)showWeatherResult(data);else addBot(`ЁЯЪл ${_t('weather_error')}`);},()=>addBot(`ЁЯЪл ${_t('weather_error')}`),{enableHighAccuracy:true,timeout:10000});
}
async function fetchWeather(lat,lon,q=null) {
  try { if(!OPENWEATHER_API_KEY||OPENWEATHER_API_KEY==='REPLACE_WITH_OPENWEATHER_API_KEY'){addBot("тЪая╕П API key not set.");return null;}
    const url=q?`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(q)}&units=metric&appid=${OPENWEATHER_API_KEY}`:`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${OPENWEATHER_API_KEY}`;
    const r=await fetch(url);return r.ok?await r.json():null;
  }catch(e){console.error(e);return null;}
}
function showWeatherResult(data) {
  if(!data){addBot(`ЁЯЪл ${_t('weather_error')}`);return;}
  const name=data.name||'Your Location',temp=Math.round(data.main.temp),cond=data.weather[0].description,hum=data.main.humidity,wind=Math.round(data.wind.speed*3.6);
  let suggestion=_t('weather_suggestion_normal');
  if(temp>35)suggestion=_t('weather_suggestion_hot');else if(temp<18)suggestion=_t('weather_suggestion_cool');else if((data.weather[0].main||'').toLowerCase().includes('rain'))suggestion=_t('weather_suggestion_rain');
  addBot(`<b>ЁЯУН ${name}</b>: ${temp}┬░C, ${cond}.`, `ЁЯТз <b>Humidity:</b> ${hum}%<br>ЁЯТи <b>Wind:</b> ${wind} km/h<br><br><i>${suggestion}</i>`);
  addOptions([ { k: 'weather', t: `ЁЯМ▒ ${_t('suggest_after_weather_title')}` }, { k: 'irrigation', t: `ЁЯТз ${_t('suggest_after_irrigation_title')}` }, { k: 'market', t: `ЁЯУИ ${_t('suggest_after_market_title')}` } ], key => {
      if (key === 'market') { addUser(`ЁЯУИ ${_t('suggest_after_market_title')}`); startMarketFlow(); }
      else if (key === 'weather') { addUser(`ЁЯМ▒ ${_t('suggest_after_weather_title')}`); startCropFlow(); }
      else { addUser(`ЁЯТз ${_t('suggest_after_irrigation_title')}`); addBot(suggestion); }
  }, _t('next_steps_label'));
}

/* ============================ Input & Navigation ============================ */
sendBtn.addEventListener('click',handleSend);inputBox.addEventListener('keydown',e=>{if(e.key==='Enter')handleSend();});
async function handleSend() {
  const txt=inputBox.value.trim();if(!txt)return;
  inputBox.value='';suggestionsBox.style.display='none';addUser(txt);
  const last=FLOW[FLOW.length-1];
  if(last&&last.step==='await-weather'){ FLOW.pop();addBot(_t('weather_fetching'));const data=await fetchWeather(null,null,txt);if(data)showWeatherResult(data);else addBot(_t('weather_error'));return; }
  addBot("ЁЯдФ "+_t('unknown'));
}
restartBtn.addEventListener('click',()=>resetFlow());
document.addEventListener('keydown', e=>{if(e.key==='Escape')closeChatWindow();});
</script>
</body>
</html>