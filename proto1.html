<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kerala Agri Helper — Final Version</title>
  <style>
    :root{
      --bg-1: #f4f7f6;
      --muted: #52525b;
      --accent-1: #14b8a6; /* teal-500 */
      --accent-2: #4f46e5; /* indigo-600 */
      --accent-dark: #0f766e; /* teal-700 */
      --user-bg: #3b82f6; /* blue-500 */
      --user-text: #ffffff;
      --bot-bg: #ffffff;
      --bot-text: #0f172a; /* slate-900 for high contrast */
      --card-shadow: 0 4px 16px rgba(0,0,0,0.05);
      --radius: 12px;
      --font: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    html,body{height:100%;margin:0;font-family:var(--font);background:var(--bg-1);-webkit-font-smoothing:antialiased}
    .launcher { position:fixed; right:20px; bottom:20px; z-index:1400; }
    .bubble { width:64px; height:64px; border-radius:50%; background:linear-gradient(135deg, var(--accent-1), var(--accent-2)); display:flex; align-items:center; justify-content:center; box-shadow:0 10px 30px rgba(0,0,0,0.15); cursor:pointer; color:white; transition: transform .2s ease-in-out; }
    .bubble:hover{ transform: scale(1.1); }
    .chat-window { position:fixed; right:20px; bottom:96px; min-width:300px; height:80vh; z-index:1400; border-radius:18px; background: #f9fafb; box-shadow: 0 20px 60px -10px rgba(0,0,0,0.15); overflow:hidden; display:flex; flex-direction:column; transform-origin: right bottom; border:1px solid #e5e7eb; }
    .chat-hidden { display:none; }
    .cw-header { display:flex; align-items:center; gap:14px; padding:12px 20px; background:var(--bot-bg); border-bottom: 1px solid #e5e7eb;}
    .logo { width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg, var(--accent-1), var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700; color: white; font-size: 13px; }
    .title { font-weight:700; font-size:12px; color: var(--bot-text); }
    .subtitle { font-size:8px; color: var(--muted); }
    .cw-actions { margin-left:auto; display:flex; gap:8px; align-items:center }
    .lang-pill { padding:6px 12px; border-radius:999px; background: #f3f4f6; color:var(--muted); cursor:pointer; font-weight:600; border:1px solid transparent; transition: all .2s ease; }
    .lang-pill.active { background:var(--accent-1); color:white; font-weight: 700; }
    .small-btn{ background: #f3f4f6; color:var(--muted); border: 1px solid #e5e7eb; width: 32px; height: 32px; border-radius:50%; cursor:pointer; font-weight:700; display:flex; align-items:center; justify-content:center; }
    .chat-body { flex:1; padding:24px; overflow:auto; display:flex; flex-direction:column; gap:20px; }
    .msg { max-width:80%; padding:14px 18px; border-radius:var(--radius); line-height:1.6; animation:fadeIn .2s ease both; font-size: 10px; }
    .msg.bot { align-self:flex-start; background:var(--bot-bg); color:var(--bot-text); border:1px solid #e5e7eb; box-shadow: var(--card-shadow); }
    .msg.user { align-self:flex-end; background:var(--user-bg); color:var(--user-text); font-weight: 500; }
    .msg.bot b { font-weight: 600; color: #020617; }
    .report-card { padding: 16px; border-left: 4px solid var(--accent-1); }
    .report-card .report-line { margin-bottom: 12px; }
    .report-card .report-line b { display:block; font-size: 9px; color: var(--muted); margin-bottom: 2px; text-transform: uppercase; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }
    .options-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px; margin-top:12px }
    .card { background:var(--bot-bg); border-radius:10px; padding:12px; cursor:pointer; border:1px solid #e5e7eb; display:flex; flex-direction:column; gap:4px; transition: all .2s ease; }
    .card:hover { transform:translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.08); border-color: var(--accent-1); }
    .card .title { font-weight:700; color:var(--accent-dark); font-size: 11px; }
    .card .sub { font-size:9px; color:var(--muted); }
    .chat-footer { padding:12px 20px; border-top:1px solid #e5e7eb; display:flex; gap:12px; align-items:center; justify-content: center; background: #f9fafb; }
    .action-btn { background:white; padding: 10px 16px; height: 44px; border-radius: 999px; border:1px solid #d1d5db; cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight: 600; gap: 8px; }
    .note { font-size:11px; color:var(--muted); padding-top: 4px; }
    @media (max-width:900px){ .chat-window{ right:12px; left:12px; width:calc(100% - 24px); bottom:90px; height: 85vh; } }
  </style>
</head>
<body>

  <div class="launcher" id="launcher"><div class="bubble" id="openChat" title="Open Agri Helper"><svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M12 3C7 3 3 6 3 10.25c0 1.92.9 3.7 2.47 5.06L6 20l4.07-1.95c.94.2 1.92.29 2.93.29 5 0 9-3 9-7.25S17 3 12 3z" fill="white"/></svg></div></div>
  <div class="chat-window chat-hidden" id="chatWindow" role="dialog" aria-label="Kerala Agri Helper Chat">
    <div class="cw-header">
      <div class="logo">KA</div><div><div class="title">Kerala Agri Helper</div><div class="subtitle">Your AI farming assistant</div></div>
      <div class="cw-actions"><div class="lang-pill active" data-lang="en">EN</div><div class="lang-pill" data-lang="ml">മലയാളം</div><div class="lang-pill" data-lang="ta">தமிழ்</div><button class="small-btn" id="closeBtn" title="Close">✕</button></div>
    </div>
    <div class="chat-body" id="chatBody" aria-live="polite"></div>
    <div class="chat-footer">
      <button class="action-btn" id="backBtn" title="Back">⬅️ Back</button>
      <button class="action-btn" id="restartBtn" title="Restart">🔄 Main Menu</button>
    </div>
  </div>

<script>
/* ============================ I18N - UI STRINGS ============================ */
const I18N = {
  en: {
    welcome: "Welcome!", startPrompt: "Please select a topic to begin.", home: "Home", next_steps_label: "➡️ What's next?",
    back_button: "⬅️ Back", restart_button: "🔄 Main Menu",
    list_title_crops: "Please select a crop:", list_title_soils: "Please select a soil type:", list_title_fertilizers: "Please select a fertilizer:",
    list_title_pests: "Please select a pest or disease:", list_title_market: "Select a crop to see its market trend:", list_title_schemes: "Please select a scheme:",
    list_title_resistant_varieties: "Varieties resistant to {pest}:",
    sugg_check_soil: "🏞️ Check Soil Types", sugg_explore_fertilizers: "💧 Explore Fertilizers", sugg_lookup_pests: "🐛 Look up Pests & Diseases", sugg_see_market: "📈 See Market Trends",
    sugg_explore_crops: "🌾 Explore Crops", sugg_check_fertilizers: "💧 Check Fertilizers",
    sugg_resistant_varieties: "🌾 See Resistant Crop Varieties", sugg_check_weather: "☁️ Check Weather",
    sugg_check_schemes: "🏛️ Check Govt Schemes", sugg_explore_another_crop: "🌾 Explore another Crop",
    sugg_see_crop_guides: "🌾 See Crop Guides", sugg_learn_about_soil: "🏞️ Learn about Soil",
    sugg_check_suitable_crops: "🌾 Check Suitable Crops",
    sugg_pests_regional: "🐛 View Common Pests", sugg_schemes_land: "🏛️ Find Land Schemes", sugg_fert_for_strength: "💧 Fertilizers for Plant Strength",
    sugg_market_for_season: "📈 Market Trends this Season", sugg_soil_for_climate: "🏞️ Explore Soils for this Climate"
  },
  ml: {
    welcome: "സ്വാഗതം!", startPrompt: "ആരംഭിക്കാൻ ദയവായി ഒരു വിഷയം തിരഞ്ഞെടുക്കുക.", home: "ഹോം", next_steps_label: "➡️ അടുത്തത് എന്ത്?",
    back_button: "⬅️ പിന്നോട്ട്", restart_button: "🔄 പ്രധാന മെനു",
    list_title_crops: "ദയവായി ഒരു വിള തിരഞ്ഞെടുക്കുക:", list_title_soils: "ദയവായി ഒരു മണ്ണിനം തിരഞ്ഞെടുക്കുക:", list_title_fertilizers: "ദയവായി ഒരു വളം തിരഞ്ഞെടുക്കുക:",
    list_title_pests: "ദയവായി ഒരു കീടം/രോഗം തിരഞ്ഞെടുക്കുക:", list_title_market: "വിപണി നിലവാരം കാണാൻ ഒരു വിള തിരഞ്ഞെടുക്കുക:", list_title_schemes: "ദയവായി ഒരു പദ്ധതി തിരഞ്ഞെടുക്കുക:",
    list_title_resistant_varieties: "{pest}-നെ പ്രതിരോധിക്കുന്ന ഇനങ്ങൾ:",
    sugg_check_soil: "🏞️ മണ്ണിനങ്ങൾ പരിശോധിക്കുക", sugg_explore_fertilizers: "💧 വളങ്ങൾ കണ്ടെത്തുക", sugg_lookup_pests: "🐛 കീടങ്ങളെയും രോഗങ്ങളെയും കണ്ടെത്തുക", sugg_see_market: "📈 വിപണി നിലവാരം കാണുക",
    sugg_explore_crops: "🌾 വിളകൾ കണ്ടെത്തുക", sugg_check_fertilizers: "💧 വളങ്ങൾ പരിശോധിക്കുക",
    sugg_resistant_varieties: "🌾 പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ കാണുക", sugg_check_weather: "☁️ കാലാവസ്ഥ പരിശോധിക്കുക",
    sugg_check_schemes: "🏛️ സർക്കാർ പദ്ധതികൾ പരിശോധിക്കുക", sugg_explore_another_crop: "🌾 മറ്റൊരു വിള കണ്ടെത്തുക",
    sugg_see_crop_guides: "🌾 വിള ഗൈഡുകൾ കാണുക", sugg_learn_about_soil: "🏞️ മണ്ണിനെക്കുറിച്ച് പഠിക്കുക",
    sugg_check_suitable_crops: "🌾 അനുയോജ്യമായ വിളകൾ പരിശോധിക്കുക",
    sugg_pests_regional: "🐛 സാധാരണ കീടങ്ങളെ കാണുക", sugg_schemes_land: "🏛️ ഭൂമി സംബന്ധമായ പദ്ധതികൾ", sugg_fert_for_strength: "💧 ചെടിയുടെ കരുത്തിന് വളങ്ങൾ",
    sugg_market_for_season: "📈 ഈ സീസണിലെ വിപണി", sugg_soil_for_climate: "🏞️ ഈ കാലാവസ്ഥയ്ക്ക് അനുയോജ്യമായ മണ്ണ്"
  },
  ta: {
    welcome: "வருக!", startPrompt: "தொடங்குவதற்கு ഒരു தலைப்பைத் தேர்ந்தெடுக்கவும்.", home: "முகப்பு", next_steps_label: "➡️ அடுத்து என்ன?",
    back_button: "⬅️ பின்செல்", restart_button: "🔄 முதன்மை பட்டி",
    list_title_crops: "ഒരു பயிரைத் தேர்ந்தெடுக்கவும்:", list_title_soils: "ഒരു மண் வகையைத் தேர்ந்தெடுக்கவும்:", list_title_fertilizers: "ஒரு உரத்தைத் தேர்ந்தெடுக்கவும்:",
    list_title_pests: "ஒரு பூச்சி அல்லது நோயைத் தேர்ந்தெடுக்கவும்:", list_title_market: "சந்தை நிலவரம் காண ஒரு பயிரைத் தேர்ந்தெடுக்கவும்:", list_title_schemes: "ஒரு திட்டத்தைத் தேர்ந்தெடுக்கவும்:",
    list_title_resistant_varieties: "{pest}க்கு எதிரான வகைகள்:",
    sugg_check_soil: "🏞️ மண் வகைகளைச் சரிபார்க்கவும்", sugg_explore_fertilizers: "💧 உரங்களை ஆராயுங்கள்", sugg_lookup_pests: "🐛 பூச்சிகள் மற்றும் நோய்களைப் பார்க்கவும்", sugg_see_market: "📈 சந்தை நிலவரங்களைக் காண்க",
    sugg_explore_crops: "🌾 பயிர்களை ஆராயுங்கள்", sugg_check_fertilizers: "💧 உரங்களைச் சரிபார்க்கவும்",
    sugg_resistant_varieties: "🌾 எதிர்ப்புத் திறன் கொண்ட வகைகளைக் காண்க", sugg_check_weather: "☁️ வானிலை சரிபார்க்கவும்",
    sugg_check_schemes: "🏛️ அரசாங்க திட்டங்களைச் சரிபார்க்கவும்", sugg_explore_another_crop: "🌾 மற்றொரு பயிரை ஆராயுங்கள்",
    sugg_see_crop_guides: "🌾 பயிர் வழிகாட்டிகளைக் காண்க", sugg_learn_about_soil: "🏞️ மண் பற்றி அறியுங்கள்",
    sugg_check_suitable_crops: "🌾 பொருத்தமான பயிர்களைச் சரிபார்க்கவும்",
    sugg_pests_regional: "🐛 பொதுவான பூச்சிகளைக் காண்க", sugg_schemes_land: "🏛️ நிலத் திட்டங்களைக் கண்டறியவும்", sugg_fert_for_strength: "💧 தாவர வலிமைக்கான உரங்கள்",
    sugg_market_for_season: "📈 இந்த பருவத்திற்கான சந்தை", sugg_soil_for_climate: "🏞️ இந்த காலநிலைக்கு ஏற்ற மண்"
  }
};

/* ============================ CORE DATA RE-ARCHITECTED ============================ */
const DATA = {
    en: {
        features: [{k:"crops", t:"🌾 Crops"}, {k:"soils", t:"🏞️ Soil"}, {k:"fertilizers", t:"💧 Fertilizer"}, {k:"pests", t:"🐛 Pests & Diseases"}, {k:"market", t:"📈 Market Trends"}, {k:"schemes", t:"🏛️ Govt Schemes"}, {k:"weather", t:"☁️ Weather"}],
        crops: {
            "Paddy": { "Best Soil": "Alluvial, Clay", "Climate": "Hot and humid, 20-35°C", "Irrigation": "Requires standing water (2-5 cm) during growth.", "Fertilizers": "NPK in a 2:1:1 ratio. Urea should be applied in split doses.", "Common Pests": "Stem borer, Leaf roller, Blast disease." },
            "Coconut": { "Best Soil": "Laterite, Coastal Sandy", "Climate": "Tropical, high humidity, requires plenty of sunlight.", "Irrigation": "Requires regular watering, especially in summer (40-50 liters/day).", "Fertilizers": "Balanced NPK with Magnesium. Organic manure is highly beneficial.", "Common Pests": "Rhinoceros beetle, Red palm weevil, Mites." },
            "Rubber": { "Best Soil": "Laterite, Forest Loam", "Climate": "Requires high rainfall (2000-3000 mm/year) and high humidity.", "Irrigation": "Young plants need watering in dry seasons.", "Fertilizers": "NPK application is crucial in the initial years. Tapping stage requires different ratios.", "Common Pests": "Abnormal leaf fall, Powdery mildew." },
            "Banana": { "Best Soil": "Alluvial, Volcanic", "Climate": "Tropical, cannot withstand frost. Needs protection from strong winds.", "Irrigation": "High water requirement, drip irrigation is highly recommended.", "Fertilizers": "Very high potassium demand for good bunch development.", "Common Pests": "Nematodes, Sigatoka leaf spot, Bunchy top virus." },
        },
        soils: {
            "Laterite": { "Properties": "Rich in iron & aluminum, acidic, poor in nitrogen & potassium.", "Suitable Crops": "Coconut, Cashew, Rubber, Tapioca.", "Challenges": "Low water retention, needs regular manuring.", "Improvements": "Add lime to reduce acidity, apply high organic matter (compost, manure)." },
            "Alluvial": { "Properties": "Highly fertile, rich in humus & potash, good water retention.", "Suitable Crops": "Paddy, Banana, Sugarcane, Vegetables.", "Challenges": "Can be prone to flooding in low-lying areas.", "Improvements": "Ensure proper drainage systems, practice crop rotation." },
            "Coastal Sandy": { "Properties": "Low in nutrients, poor water retention, high drainage.", "Suitable Crops": "Coconut (with management), Cashew, Watermelon.", "Challenges": "Nutrient leaching is a major issue.", "Improvements": "Add high amounts of organic matter and coir pith, use drip irrigation with fertigation." },
            "Forest Loam": { "Properties": "Rich in organic matter and humus, very fertile, slightly acidic.", "Suitable Crops": "Rubber, Tea, Coffee, Spices (Pepper, Cardamom).", "Challenges": "Can be prone to erosion on slopes.", "Improvements": "Terrace farming on slopes, use cover crops to prevent soil loss." }
        },
        fertilizers: {
            "Urea": { "Benefits": "Provides Nitrogen (46% N), essential for leafy growth. Very effective for Paddy, Wheat.", "Disadvantages": "Overuse increases soil acidity and causes water pollution. Can 'burn' plants if applied incorrectly.", "Alternatives": "Organic compost, Vermicompost, Green manure (e.g., Daincha)." },
            "Potash (MOP)": { "Benefits": "Improves root strength, disease resistance, and fruit quality. Crucial for Banana, Coconut, Tapioca.", "Disadvantages": "Excess potash can interfere with the uptake of other nutrients like Magnesium and Calcium.", "Alternatives": "Wood ash (in moderation), Kelp meal, Sul-Po-Mag." },
            "DAP": { "Benefits": "Provides both Nitrogen (18%) and Phosphorus (46%). Excellent for root development at the start of planting.", "Disadvantages": "Slightly alkaline, so long-term use can raise soil pH. Not ideal for acid-loving plants without management.", "Alternatives": "Bone meal, Rock Phosphate (slow-release)." },
            "Vermicompost": { "Benefits": "100% organic, improves soil structure, water retention, and aeration. Provides balanced micro and macro nutrients.", "Disadvantages": "Slower acting than chemical fertilizers and required in larger quantities.", "Alternatives": "Farm Yard Manure (FYM), regular compost." }
        },
        pests: { 
            "Stem borer (Paddy)": { "Symptoms": "Yellowing of central shoot ('dead heart'), white empty grain heads ('white ears').", "Organic Control": "Use pheromone traps, release Trichogramma wasps.", "Chemical Control": "Apply Cartap Hydrochloride or Fipronil as recommended.", "Resistant Varieties": {"Paddy": ["Jyothi", "Uma", "IR36"]} }, 
            "Rhinoceros beetle (Coconut)": { "Symptoms": "V-shaped cuts on leaves, holes in the trunk.", "Organic Control": "Fill leaf axils with a mix of sand and neem cake. Use pheromone traps.", "Chemical Control": "Place naphthalene balls in the innermost leaf axils.", "Resistant Varieties": {"Coconut": ["Malayan Dwarf", "Chowghat Green Dwarf"]} },
            "Sigatoka leaf spot (Banana)": { "Symptoms": "Yellowish spots on leaves that turn grey with brown borders, reducing photosynthesis.", "Organic Control": "Prune and destroy infected leaves. Use Bordeaux mixture spray.", "Chemical Control": "Apply Propiconazole or Mancozeb fungicides.", "Resistant Varieties": {"Banana": ["FHIA-01", "Yangambi Km5"]} },
            "Powdery mildew (Rubber)": { "Symptoms": "White powdery coating on young leaves, leading to leaf drop and dieback.", "Organic Control": "Ensure good air circulation by proper pruning.", "Chemical Control": "Sulphur dusting during leaf refoliation period.", "Resistant Varieties": {"Rubber": ["RRII 105", "RRIM 600"]} }
        },
        market: { 
            "Paddy": { "Peak Season": "October - November, after the main Kharif harvest.", "Price Factors": "Government's Minimum Support Price (MSP), festival demand (Onam, Vishu), and monsoon performance.", "Expert Advice": "Avoid selling immediately at harvest when supply is high. Storing and selling during the off-season can fetch better prices." }, 
            "Coconut": { "Peak Season": "Demand is high during festival seasons like Onam (Aug-Sep) and Vishu (Apr).", "Price Factors": "Domestically driven by demand for coconut oil and religious offerings. Global copra prices also have an impact.", "Expert Advice": "Selling processed products like coconut oil or desiccated coconut can provide higher returns than selling whole nuts." },
            "Rubber": { "Peak Season": "Tapping is suspended during heavy monsoon (Jun-Aug), so supply is low and prices can be higher post-monsoon.", "Price Factors": "Heavily influenced by international market prices (Bangkok/Singapore), automotive industry demand, and crude oil prices.", "Expert Advice": "Follow daily RSS4 price updates from the Rubber Board. Forming co-operatives can provide better bargaining power." },
            "Banana": { "Peak Season": "Year-round demand, but specific varieties like Nendran peak during the Onam season.", "Price Factors": "Driven by local demand, transportation costs, and weather events that can disrupt supply.", "Expert Advice": "Contracts with local vendors or supermarkets can provide a stable price. Value addition like banana chips is a profitable option." }
        },
        schemes: { 
            "PM-Kisan": { "Description": "A central scheme providing ₹6000/year in three installments to small and marginal farmers.", "Eligibility": "All landholding farmer families with cultivable land.", "How to Apply": "Through the PM-KISAN portal or Common Service Centres (CSC)." },
            "Karshaka Pension": { "Description": "A Kerala state pension scheme for farmers aged 60 and above, providing a monthly pension.", "Eligibility": "Farmers with less than 2 hectares of land, who are not receiving any other pension.", "How to Apply": "Through the local Krishi Bhavan." },
            "Subiksha Keralam": { "Description": "A Kerala state project to boost agricultural production and achieve self-sufficiency in food.", "Eligibility": "Farmers, farming groups, and individuals interested in farming. Provides seeds, grants, and support.", "How to Apply": "Contact the local Krishi Bhavan for specific sub-schemes." },
            "RKVY": { "Description": "Rashtriya Krishi Vikas Yojana is a central scheme that provides funds to states for various agricultural projects, including infrastructure and mechanization.", "Eligibility": "Varies by project; implemented through the State Agriculture Department.", "How to Apply": "Proposals are usually submitted by farmer groups or panchayats via the Krishi Bhavan." }
        }
    },
    ml: {
        features: [{k:"crops", t:"🌾 വിളകൾ"}, {k:"soils", t:"🏞️ മണ്ണ്"}, {k:"fertilizers", t:"💧 വളം"}, {k:"pests", t:"🐛 കീടങ്ങളും രോഗങ്ങളും"}, {k:"market", t:"📈 വിപണി നിലവാരം"}, {k:"schemes", t:"🏛️ സർക്കാർ പദ്ധതികൾ"}, {k:"weather", t:"☁️ കാലാവസ്ഥ"}],
        crops: { "നെല്ല്": { "മികച്ച മണ്ണ്": "എക്കൽ, കളിമണ്ണ്", "കാലാവസ്ഥ": "ചൂടും ഈർപ്പവും, 20-35°C", "ജലസേചനം": "വളർച്ചാ ഘട്ടത്തിൽ വെള്ളം കെട്ടിനിർത്തണം (2-5 സെ.മീ).", "വളങ്ങൾ": "NPK 2:1:1 അനുപാതത്തിൽ. യൂറിയ പലതവണയായി നൽകണം.", "സാധാരണ കീടങ്ങൾ": "തണ്ടുതുരപ്പൻ, ഇലചുരുട്ടിപ്പുഴു, ബ്ലാസ്റ്റ് രോഗം." }, "തെങ്ങ്": { "മികച്ച മണ്ണ്": "ചെങ്കൽ, തീരദേശ മണൽ", "കാലാവസ്ഥ": "ഉഷ്ണമേഖല, ഉയർന്ന ഈർപ്പം, നല്ല സൂര്യപ്രകാശം.", "ജലസേചനം": "വേനൽക്കാലത്ത് പ്രത്യേകിച്ച് നനയ്ക്കണം (ദിവസവും 40-50 ലിറ്റർ).", "വളങ്ങൾ": "മഗ്നീഷ്യത്തോടുകൂടിയ NPK. ജൈവവളം വളരെ നല്ലതാണ്.", "സാധാരണ കീടങ്ങൾ": "കൊമ്പൻചെല്ലി, ചെമ്പൻചെല്ലി, മണ്ഡരി." }, "റബ്ബർ": { "മികച്ച മണ്ണ്": "ചെങ്കൽ, വനമണ്ണ്", "കാലാവസ്ഥ": "ഉയർന്ന മഴ (2000-3000 മി.മീ/വർഷം), ഉയർന്ന ഈർപ്പം.", "ജലസേചനം": "ചെറുപ്രായത്തിൽ വേനൽക്കാലത്ത് നനയ്ക്കണം.", "വളങ്ങൾ": "ആദ്യ വർഷങ്ങളിൽ NPK പ്രയോഗം പ്രധാനം.", "സാധാരണ കീടങ്ങൾ": "അസാധാരണമായ ഇല കൊഴിച്ചിൽ, ചൂർണ്ണ പൂപ്പ്." }, "വാഴ": { "മികച്ച മണ്ണ്": "എക്കൽ, അഗ്നിപർവ്വത മണ്ണ്", "കാലാവസ്ഥ": "ഉഷ്ണമേഖല, മഞ്ഞ് താങ്ങാനാവില്ല. ശക്തമായ കാറ്റിൽ നിന്ന് സംരക്ഷണം വേണം.", "ജലസേചനം": "ഉയർന്ന ജലലഭ്യത, തുള്ളിനന ഉത്തമം.", "വളങ്ങൾ": "നല്ല കുല ലഭിക്കാൻ ഉയർന്ന പൊട്ടാസ്യം ആവശ്യമാണ്.", "സാധാരണ കീടങ്ങൾ": "നിമാവിരകൾ, സിഗാട്ടോക്ക ഇലപ്പുള്ളി രോഗം, കുറുനാമ്പ് രോഗം." } },
        soils: { "ചെങ്കൽ": { "ഗുണങ്ങൾ": "ഇരുമ്പും അലുമിനിയവും കൂടുതൽ, അമ്ലത്വം, നൈട്രജനും പൊട്ടാസ്യവും കുറവ്.", "അനുയോജ്യമായ വിളകൾ": "തെങ്ങ്, കശുവണ്ടി, റബ്ബർ, മരച്ചീനി.", "വെല്ലുവിളികൾ": "ജലം പിടിച്ചുനിർത്താനുള്ള കഴിവ് കുറവ്, പതിവായി വളപ്രയോഗം വേണം.", "മെച്ചപ്പെടുത്തലുകൾ": "അമ്ലത്വം കുറയ്ക്കാൻ കുമ്മായം ചേർക്കുക, ജൈവവസ്തുക്കൾ ചേർക്കുക." }, "എക്കൽ": { "ഗുണങ്ങൾ": "വളരെ ഫലഭൂയിഷ്ഠം, ഹ്യൂമസ്, പൊട്ടാഷ് എന്നിവ കൂടുതൽ, നല്ല ജലസംഭരണ ശേഷി.", "അനുയോജ്യമായ വിളകൾ": "നെല്ല്, വാഴ, കരിമ്പ്, പച്ചക്കറികൾ.", "വെല്ലുവിളികൾ": "താഴ്ന്ന പ്രദേശങ്ങളിൽ വെള്ളപ്പൊക്കത്തിന് സാധ്യത.", "മെച്ചപ്പെടുത്തലുകൾ": "ശരിയായ ഡ്രെയിനേജ് സംവിധാനങ്ങൾ ഉറപ്പാക്കുക." }, "തീരദേശ മണൽ": { "ഗുണങ്ങൾ": "പോഷകങ്ങൾ കുറവ്, ജലം പിടിച്ചുനിർത്താനുള്ള കഴിവ് കുറവ്.", "അനുയോജ്യമായ വിളകൾ": "തെങ്ങ് (പരിപാലനത്തോടെ), കശുവണ്ടി, തണ്ണിമത്തൻ.", "വെല്ലുവിളികൾ": "പോഷകങ്ങൾ നഷ്ടപ്പെടുന്നത് ഒരു പ്രധാന പ്രശ്നമാണ്.", "മെച്ചപ്പെടുത്തലുകൾ": "ജൈവവസ്തുക്കളും ചകിരിച്ചോറും ചേർക്കുക, തുള്ളിനന ഉപയോഗിക്കുക." }, "വനമണ്ണ്": { "ഗുണങ്ങൾ": "ജൈവവസ്തുക്കളും ഹ്യൂമസും കൂടുതൽ, വളരെ ഫലഭൂയിഷ്ഠം.", "അനുയോജ്യമായ വിളകൾ": "റബ്ബർ, ചായ, കാപ്പി, സുഗന്ധവ്യഞ്ജനങ്ങൾ.", "വെല്ലുവിളികൾ": "ചരിവുകളിൽ മണ്ണൊലിപ്പിന് സാധ്യത.", "മെച്ചപ്പെടുത്തലുകൾ": "തട്ടുതട്ടായ കൃഷി, മണ്ണൊലിപ്പ് തടയാൻ ആവരണ വിളകൾ ഉപയോഗിക്കുക." } },
        fertilizers: { "യൂറിയ": { "ഗുണങ്ങൾ": "നൈട്രജൻ നൽകുന്നു, ഇലകളുടെ വളർച്ചയ്ക്ക് അത്യാവശ്യമാണ്.", "ദോഷങ്ങൾ": "അമിതോപയോഗം മണ്ണിന്റെ അമ്ലത്വം വർദ്ധിപ്പിക്കും. തെറ്റായി പ്രയോഗിച്ചാൽ ചെടികൾക്ക് 'പൊള്ളൽ' ഏൽക്കാം.", "ബദലുകൾ": "ജൈവ കമ്പോസ്റ്റ്, മണ്ണിര കമ്പോസ്റ്റ്." }, "പൊട്ടാഷ് (MOP)": { "ഗുണങ്ങൾ": "വേരുകളുടെ ബലം, രോഗപ്രതിരോധ ശേഷി, പഴങ്ങളുടെ ഗുണമേന്മ എന്നിവ മെച്ചപ്പെടുത്തുന്നു.", "ദോഷങ്ങൾ": "അമിതമായ പൊട്ടാഷ് മറ്റ് പോഷകങ്ങളെ വലിച്ചെടുക്കുന്നത് തടസ്സപ്പെടുത്തും.", "ബദലുകൾ": "മരത്തിന്റെ ചാരം, കടൽപ്പായൽ." }, "ഡിഎപി": { "ഗുണങ്ങൾ": "നൈട്രജനും ഫോസ്ഫറസും നൽകുന്നു. വേരുകളുടെ വികാസത്തിന് മികച്ചതാണ്.", "ദോഷങ്ങൾ": "ദീർഘകാല ഉപയോഗം മണ്ണിന്റെ pH വർദ്ധിപ്പിക്കാം.", "ബദലുകൾ": "എല്ലുപൊടി, റോക്ക് ഫോസ്ഫേറ്റ്." }, "മണ്ണിര കമ്പോസ്റ്റ്": { "ഗുണങ്ങൾ": "100% ജൈവവളം, മണ്ണിന്റെ ഘടനയും ജലസംഭരണ ശേഷിയും മെച്ചപ്പെടുത്തുന്നു.", "ദോഷങ്ങൾ": "രാസവളങ്ങളേക്കാൾ സാവധാനത്തിൽ പ്രവർത്തിക്കുന്നു, കൂടുതൽ അളവിൽ ആവശ്യമാണ്.", "ബദലുകൾ": "ചാണകപ്പൊടി, സാധാരണ കമ്പോസ്റ്റ്." } },
        pests: { "തണ്ടുതുരപ്പൻ (നെല്ല്)": { "ലക്ഷണങ്ങൾ": "നാമ്പിന് മഞ്ഞനിറം ('ഡെഡ് ഹാർട്ട്'), വെളുത്ത പതിരുകൾ ('വൈറ്റ് ഇയർ').", "ജൈവ നിയന്ത്രണം": "ഫിറമോൺ കെണികൾ ഉപയോഗിക്കുക, ട്രൈക്കോഗ്രാമ കടന്നലുകളെ വിടുക.", "രാസ നിയന്ത്രണം": "ശുപാർശ ചെയ്ത പ്രകാരം കാർട്ടാപ് ഹൈഡ്രോക്ലോറൈഡ് അല്ലെങ്കിൽ ഫിപ്രോനിൽ പ്രയോഗിക്കുക.", "പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ": {"നെല്ല്": ["ജ്യോതി", "ഉമ", "IR36"]} }, "കൊമ്പൻചെല്ലി (തെങ്ങ്)": { "ലക്ഷണങ്ങൾ": "ഓലകളിൽ 'V' ആകൃതിയിലുള്ള മുറിവുകൾ, തടിയിൽ ദ്വാരങ്ങൾ.", "ജൈവ നിയന്ത്രണം": "ഓലയുടെ കവിളുകളിൽ മണലും വേപ്പിൻപിണ്ണാക്കും നിറയ്ക്കുക.", "രാസ നിയന്ത്രണം": "നാഫ്തലീൻ ബോളുകൾ ഏറ്റവും ഉള്ളിലെ ഓലക്കവിളുകളിൽ വയ്ക്കുക.", "പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ": {"തെങ്ങ്": ["മലയൻ കുറിയ ഇനം", "ചാവക്കാട് പച്ച കുറിയ ഇനം"]} }, "സിഗാട്ടോക്ക ഇലപ്പുള്ളി (വാഴ)": { "ലക്ഷണങ്ങൾ": "ഇലകളിൽ മഞ്ഞപ്പുള്ളികൾ, പിന്നീട് ചാരനിറമാകുന്നു, ഇലകൾ കരിയുന്നു.", "ജൈവ നിയന്ത്രണം": "രോഗം ബാധിച്ച ഇലകൾ മുറിച്ച് നശിപ്പിക്കുക. ബോർഡോ മിശ്രിതം തളിക്കുക.", "രാസ നിയന്ത്രണം": "പ്രൊപ്പികൊനാസോൾ അല്ലെങ്കിൽ മാങ്കോസെബ് കുമിൾനാശിനികൾ പ്രയോഗിക്കുക.", "പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ": {"വാഴ": ["FHIA-01", "യാങ്കാമ്പി Km5"]} }, "ചൂർണ്ണ പൂപ്പ് (റബ്ബർ)": { "ലക്ഷണങ്ങൾ": "ഇളം ഇലകളിൽ വെളുത്ത പൊടി, ഇത് ഇല കൊഴിച്ചിലിന് കാരണമാകുന്നു.", "ജൈവ നിയന്ത്രണം": "കൊമ്പുകോതൽ വഴി നല്ല വായുസഞ്ചാരം ഉറപ്പാക്കുക.", "രാസ നിയന്ത്രണം": "തളിരിലകൾ വരുമ്പോൾ സൾഫർ പൊടി വിതറുക.", "പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ": {"റബ്ബർ": ["RRII 105", "RRIM 600"]} } },
        market: { "നെല്ല്": { "ഉയർന്ന സീസൺ": "പ്രധാന വിളവെടുപ്പിന് ശേഷം ഒക്ടോബർ-നവംബർ മാസങ്ങളിൽ.", "വിലയെ സ്വാധീനിക്കുന്ന ഘടകങ്ങൾ": "സർക്കാരിന്റെ താങ്ങുവില (MSP), ഉത്സവകാല ആവശ്യം (ഓണം, വിഷു), മൺസൂൺ.", "വിദഗ്ദ്ധോപദേശം": "വിളവെടുപ്പ് സമയത്ത് വിൽക്കുന്നത് ഒഴിവാക്കുക. സംഭരിച്ച് ഓഫ് സീസണിൽ വിൽക്കുന്നത് നല്ല വില നൽകും." }, "തെങ്ങ്": { "ഉയർന്ന സീസൺ": "ഓണം (ആഗസ്റ്റ്-സെപ്റ്റംബർ), വിഷു (ഏപ്രിൽ) പോലുള്ള ഉത്സവകാലങ്ങളിൽ ആവശ്യം വർധിക്കുന്നു.", "വിലയെ സ്വാധീനിക്കുന്ന ഘടകങ്ങൾ": "വെളിച്ചെണ്ണയുടെയും മതപരമായ ആവശ്യങ്ങളുടെയും ആഭ്യന്തര ആവശ്യം.", "വിദഗ്ദ്ധോപദേശം": "തേങ്ങയെക്കാൾ വെളിച്ചെണ്ണ പോലുള്ള ഉൽപ്പന്നങ്ങൾ വിൽക്കുന്നത് കൂടുതൽ ലാഭം നൽകും." }, "റബ്ബർ": { "ഉയർന്ന സീസൺ": "മൺസൂൺ കാലത്ത് ടാപ്പിംഗ് കുറവായതിനാൽ, അതിനുശേഷം വില കൂടാം.", "വിലയെ സ്വാധീനിക്കുന്ന ഘടകങ്ങൾ": "അന്താരാഷ്ട്ര വിപണി വില, വാഹന വ്യവസായത്തിന്റെ ആവശ്യം.", "വിദഗ്ദ്ധോപദേശം": "റബ്ബർ ബോർഡിന്റെ RSS4 വില ദിവസവും പിന്തുടരുക. സഹകരണ സംഘങ്ങൾ നല്ല വിലപേശൽ ശക്തി നൽകും." }, "വാഴ": { "ഉയർന്ന സീസൺ": "വർഷം മുഴുവനും ഡിമാൻഡ് ഉണ്ട്, ഓണക്കാലത്ത് നേന്ത്രന് വില കൂടും.", "വിലയെ സ്വാധീനിക്കുന്ന ഘടകങ്ങൾ": "പ്രാദേശിക ആവശ്യം, ഗതാഗതച്ചെലവ്, കാലാവസ്ഥ.", "വിദഗ്ദ്ധോപദേശം": "പ്രാദേശിക കച്ചവടക്കാരുമായുള്ള കരാറുകൾ സ്ഥിരമായ വില നൽകും. ചിപ്സ് പോലുള്ള മൂല്യവർദ്ധിത ഉൽപ്പന്നങ്ങൾ ലാഭകരമാണ്." } },
        schemes: { "പിഎം-കിസാൻ": { "വിവരണം": "ചെറുകിട കർഷകർക്ക് വർഷം ₹6000 മൂന്ന് ഗഡുക്കളായി നൽകുന്ന കേന്ദ്ര പദ്ധതി.", "യോഗ്യത": "കൃഷിയോഗ്യമായ ഭൂമിയുള്ള എല്ലാ കർഷക കുടുംബങ്ങൾക്കും.", "അപേക്ഷിക്കേണ്ട വിധം": "പിഎം-കിസാൻ പോർട്ടൽ വഴിയോ കോമൺ സർവീസ് സെന്ററുകൾ വഴിയോ." }, "കർഷക പെൻഷൻ": { "വിവരണം": "60 വയസ്സിനു മുകളിലുള്ള കർഷകർക്കുള്ള കേരള സർക്കാർ പെൻഷൻ പദ്ധതി.", "യോഗ്യത": "2 ഹെക്ടറിൽ താഴെ ഭൂമിയുള്ള, മറ്റ് പെൻഷനുകൾ ലഭിക്കാത്ത കർഷകർ.", "അപേക്ഷിക്കേണ്ട വിധം": "പ്രാദേശിക കൃഷിഭവൻ വഴി." }, "സുഭിക്ഷ കേരളം": { "വിവരണം": "കാർഷിക ഉത്പാദനം വർദ്ധിപ്പിക്കുന്നതിനും ഭക്ഷ്യ സ്വയംപര്യാപ്തത കൈവരിക്കുന്നതിനുമുള്ള കേരള സർക്കാർ പദ്ധതി.", "യോഗ്യത": "കർഷകർ, കർഷക സംഘങ്ങൾ, കൃഷിയിൽ താല്പര്യമുള്ള വ്യക്തികൾ. വിത്തുകളും സഹായങ്ങളും നൽകുന്നു.", "അപേക്ഷിക്കേണ്ട വിധം": "ഉപപദ്ധതികൾക്കായി പ്രാദേശിക കൃഷിഭവനുമായി ബന്ധപ്പെടുക." }, "RKVY": { "വിവരണം": "കാർഷിക അടിസ്ഥാന സൗകര്യങ്ങൾക്കും യന്ത്രവൽക്കരണത്തിനും സംസ്ഥാനങ്ങൾക്ക് ഫണ്ട് നൽകുന്ന കേന്ദ്ര പദ്ധതി.", "യോഗ്യത": "പദ്ധതി അനുസരിച്ച് വ്യത്യാസപ്പെടുന്നു; സംസ്ഥാന കൃഷി വകുപ്പ് വഴി നടപ്പിലാക്കുന്നു.", "അപേക്ഷിക്കേണ്ട വിധം": "കൃഷിഭവൻ വഴി കർഷക സംഘങ്ങൾക്കോ പഞ്ചായത്തുകൾക്കോ നിർദ്ദേശങ്ങൾ സമർപ്പിക്കാം." } }
    },
    ta: {
        features: [{k:"crops", t:"🌾 பயிர்கள்"}, {k:"soils", t:"🏞️ மண்"}, {k:"fertilizers", t:"💧 உரம்"}, {k:"pests", t:"🐛 பூச்சிகள் & நோய்கள்"}, {k:"market", t:"📈 சந்தை நிலவரம்"}, {k:"schemes", t:"🏛️ அரசாங்க திட்டங்கள்"}, {k:"weather", t:"☁️ வானிலை"}],
        crops: { "நெல்": { "சிறந்த மண்": "வண்டல், களிமண்", "காலநிலை": "வெப்பமான மற்றும் ஈரப்பதமான, 20-35°C", "நீர்ப்பாசனம்": "வளர்ச்சியின் போது தேங்கி நிற்கும் நீர் (2-5 செ.மீ) தேவை.", "உரங்கள்": "NPK 2:1:1 விகிதத்தில். யூரியாவை பிரித்து இட வேண்டும்.", "பொதுவான பூச்சிகள்": "தண்டு துளைப்பான், இலை சுருட்டு புழு, குலைநோய்." }, "தென்னை": { "சிறந்த மண்": "செம்மண், கடலோர மணல்", "காலநிலை": "வெப்பமண்டல, அதிக ஈரப்பதம், ധാരാളം സൂര്യപ്രകാശം.", "நீர்ப்பாசனம்": "குறிப்பாக கோடையில் வழக்கமான ನೀர்ப்பாசனம் தேவை (40-50 லிட்டர்/நாள்).", "உரங்கள்": "மக்னீசியத்துடன் கூடிய சமச்சீர் NPK. ജൈவ உரம் மிகவும் நன்மை பயக்கும்.", "பொதுவான பூச்சிகள்": "காண்டாமிருக வண்டு, சிவப்பு பனை வண்டு, சிலந்திகள்." }, "ரப்பர்": { "சிறந்த மண்": "செம்மண், காட்டு வண்டல் மண்", "காலநிலை": "அதிக மழைப்பொழிவு (2000-3000 மிமீ/ஆண்டு) மற்றும் அதிக ஈரப்பதம் தேவை.", "நீர்ப்பாசனம்": "இளம் செடிகளுக்கு வறண்ட காலங்களில் ನೀர்ப்பாசனம் தேவை.", "உரங்கள்": "ஆரம்ப ஆண்டுகளில் NPK பயன்பாடு முக்கியமானது.", "பொதுவான பூச்சிகள்": "இலை உதிர்தல், சாம்பல் நோய்." }, "வாழை": { "சிறந்த மண்": "வண்டல், எரிமலை மண்", "காலநிலை": "வெப்பமண்டல, பனியைத் தாங்காது. బలమైన കാറ്റில் നിന്ന് பாதுகாப்பு தேவை.", "நீர்ப்பாசனம்": "அதிக நீர் தேவை, சொட்டு நீர் பாசனம் மிகவும் பரிந்துரைக்கப்படுகிறது.", "உரங்கள்": "நல்ல குலை வளர்ச்சிக்கு மிக அதிக பொட்டாசியம் தேவை.", "பொதுவான பூச்சிகள்": "நூற்புழுக்கள், சிகடோகா இலைப்புள்ளி நோய், குட்டை இலை வைரஸ்." } },
        soils: { "செம்மண்": { "பண்புகள்": "இரும்பு மற்றும் அலுமினியம் நிறைந்தது, அமிலத்தன்மை, நைட்ரஜன் மற்றும் பொட்டாசியம் குறைவு.", "பொருத்தமான பயிர்கள்": "தென்னை, முந்திரி, ரப்பர், மரவள்ளிக்கிழங்கு.", "சவால்கள்": "குறைந்த நீர் தேக்கும் திறன், வழக்கமான உரமிடுதல் தேவை.", "மேம்பாடுகள்": "அமிலத்தன்மையைக் குறைக்க சுண்ணாம்பு சேர்க்கவும், அதிக ജൈவப் பொருட்களைப் பயன்படுத்தவும்." }, "வண்டல் மண்": { "பண்புகள்": "மிகவும் வளமானது, மட்கிய சத்து மற்றும் பொட்டாஷ் நிறைந்தது, நல்ல நீர் தேக்கும் திறன்.", "பொருத்தமான பயிர்கள்": "நெல், வாழை, கரும்பு, காய்கறிகள்.", "சவால்கள்": "தாழ்வான பகுதிகளில் வெள்ளப்பெருக்குக்கு ஆளாக நேரிடும்.", "மேம்பாடுகள்": "சரியான வடிகால் அமைப்புகளை உறுதி செய்யவும்." }, "கடலோர மணல்": { "பண்புகள்": "ஊட்டச்சத்துக்கள் குறைவு, குறைந்த நீர் தேக்கும் திறன்.", "பொருத்தமான பயிர்கள்": "தென்னை (நிர்வாகத்துடன்), முந்திரி, தர்பூசணி.", "சவால்கள்": "ஊட்டச்சத்து இழப்பு ஒரு முக்கிய பிரச்சினை.", "மேம்பாடுகள்": "அதிக அளவு ജൈவப் பொருட்கள் மற்றும் தென்னை நார் கழிவுகளைச் சேர்க்கவும், சொட்டு நீர் பாசனத்தைப் பயன்படுத்தவும்." }, "காட்டு வண்டல் மண்": { "பண்புகள்": "ജൈவப் பொருட்கள் மற்றும் மட்கிய சத்து நிறைந்தது, மிகவும் வளமானது.", "பொருத்தமான பயிர்கள்": "ரப்பர், தேயிலை, காபி, மசாலாப் பொருட்கள்.", "சவால்கள்": "சரிவுகளில் மண் அரிப்புக்கு ஆளாக நேரிடும்.", "மேம்பாடுகள்": "சரிவுகளில் மொட்டை மாடி விவசாயம், மண் இழப்பைத் தடுக்க மூடு பயிர்களைப் பயன்படுத்தவும்." } },
        fertilizers: { "யூரியா": { "நன்மைகள்": "நைட்ரஜனை வழங்குகிறது, இலை வளர்ச்சிக்கு அவசியம்.", "தீமைகள்": "அதிகப்படியான பயன்பாடு மண்ணின் அமிலத்தன்மையை அதிகரிக்கும். தவறாகப் பயன்படுத்தினால் செடிகளை 'எரிக்க' முடியும்.", "மாற்றுகள்": "ജൈவ உரம், மண்புழு உரம்." }, "பொட்டாஷ் (MOP)": { "நன்மைகள்": "வேர்களின் வலிமை, நோய் எதிர்ப்பு சக்தி மற்றும் பழத்தின் தரத்தை மேம்படுத்துகிறது.", "தீமைகள்": "அதிகப்படியான பொட்டாஷ் மற்ற ஊட்டச்சத்துக்களை உறிஞ்சுவதைத் தடுக்கலாம்.", "மாற்றுகள்": "மர சாம்பல், கடற்பாசி." }, "டிஏபி": { "நன்மைகள்": "நைட்ரஜன் மற்றும் பாஸ்பரஸ் இரண்டையும் வழங்குகிறது. வேர் வளர்ச்சிக்கு சிறந்தது.", "தீமைகள்": "நீண்ட கால பயன்பாடு மண்ணின் pH ஐ உயர்த்தும்.", "மாற்றுகள்": "எலும்பு தூள், ராக் பாஸ்பேட்." }, "மண்புழு உரம்": { "நன்மைகள்": "100% ജൈவமானது, மண்ணின் அமைப்பு மற்றும் நீர் தேக்கும் திறனை மேம்படுத்துகிறது.", "தீமைகள்": "இரசாயன உரங்களை விட மெதுவாக செயல்படுகிறது, அதிக அளவில் தேவைப்படுகிறது.", "மாற்றுகள்": "தொழு உரம், സാധാരണ உரம்." } },
        pests: { "தண்டு துளைப்பான் (நெல்)": { "அறிகுறிகள்": "மையத் தண்டு மஞ்சள் நிறமாதல் (' இறந்த இதயம்'), வெண்மையான வெற்று தானியத் தலைகள் ('வெள்ளை காதுகள்').", "ജൈவ கட்டுப்பாடு": "இனக்கவர்ச்சிப் பொறிகளைப் பயன்படுத்தவும், டிரைக்கோகிராமா குளவிகளை வெளியிடவும்.", "இரசாயன கட்டுப்பாடு": "பரிந்துரைக்கப்பட்டபடி கார்டாப் ஹைட்ரோகுளோரைடு அல்லது ஃபிப்ரோனிலைப் பயன்படுத்தவும்.", "எதிர்ப்பு வகைகள்": {"நெல்": ["ஜோதி", "உமா", "IR36"]} }, "காண்டாமிருக வண்டு (தென்னை)": { "அறிகுறிகள்": "இலைகளில் 'V' வடிவ வெட்டுக்கள், தண்டுப்பகுதியில் துளைகள்.", "ജൈவ கட்டுப்பாடு": "இலை அச்சுகளில் மணல் மற்றும் வேப்பம் புண்ணாக்கு கலவையை நிரப்பவும்.", "இரசாயன கட்டுப்பாடு": "நாப்தலீன் உருண்டைகளை உள்ள innermost இலை அச்சுகளில் வைக்கவும்.", "எதிர்ப்பு வகைகள்": {"தென்னை": ["மலையன் குட்டை", "சௌகாட் பச்சை குட்டை"]} }, "சிகடோகா இலைப்புள்ளி (வாழை)": { "அறிகுறிகள்": "இலைகளில் மஞ்சள் புள்ளிகள், பின்னர் சாம்பல் நிறமாக மாறும், இலைகள் காய்ந்துவிடும்.", "ജൈவ கட்டுப்பாடு": "பாதிக்கப்பட்ட இலைகளை வெட்டி அழிக்கவும். போர்டோ கலவையைத் தெளிக்கவும்.", "இரசாயன கட்டுப்பாடு": "புரோபிகோனசோல் அல்லது மான்கோசெப் பூஞ்சைக் கொல்லிகளைப் பயன்படுத்தவும்.", "எதிர்ப்பு வகைகள்": {"வாழை": ["FHIA-01", "யங்காம்பி Km5"]} }, "சாம்பல் நோய் (ரப்பர்)": { "அறிகுறிகள்": "இளம் இலைகளில் வெள்ளை தூள் பூச்சு, இது இலை உதிர்வுக்கு வழிவகுக்கிறது.", "ജൈவ கட்டுப்பாடு": "சரியான கத்தரிப்பு மூலம் நல்ல காற்றோட்டத்தை உறுதி செய்யவும்.", "இரசாயன கட்டுப்பாடு": "இலைகள் மீண்டும் துளிர்க்கும் காலத்தில் கந்தகத் தூளைத் தூவவும்.", "எதிர்ப்பு வகைகள்": {"ரப்பர்": ["RRII 105", "RRIM 600"]} } },
        market: { "நெல்": { "உச்ச பருவம்": "அறுவடைக்குப் பிறகு மற்றும் பண்டிகை காலங்களில் அக்டோபர்-நவம்பர் மாதங்களில்.", "விலை காரணிகள்": "அரசாங்கத்தின் குறைந்தபட்ச ஆதரவு விலை (MSP), பண்டிகை தேவை (ஓணம், விஷு), மற்றும் பருவமழை.", "வல்லுநர் அறிவுரை": "அறுவடை நேரத்தில் உடனடியாக விற்பதைத் தவிர்க்கவும். சேமித்து வைத்து விற்பது நல்ல விலையைத் தரும்." }, "தென்னை": { "உச்ச பருவம்": "ஓணம் (ஆகஸ்ட்-செப்டம்பர்) மற்றும் விஷு (ஏப்ரல்) போன்ற பண்டிகை காலங்களில் தேவை அதிகரிக்கிறது.", "விலை காரணிகள்": "தேங்காய் எண்ணெய் மற்றும் மதപരമായ பிரசாதங்களுக்கான உள்நாட்டு தேவை.", "வல்லுநர் அறிவுரை": "முழு தேங்காயை விட தேங்காய் எண்ணெய் போன்ற பதப்படுத்தப்பட்ட பொருட்களை விற்பது அதிக வருமானம் தரும்." }, "ரப்பர்": { "உச்ச பருவம்": "பருவமழையின் போது ടാപ്പിംഗ് நிறுத்தப்படுவதால், பருவமழைக்குப் பிறகு விலை அதிகமாக இருக்கலாம்.", "விலை காரணிகள்": "சர்வதேச சந்தை விலைகள், வாகனத் தொழில் தேவை.", "வல்லுநர் அறிவுரை": "ரப்பர் வாரியத்தின் RSS4 விலை அறிவிப்புகளைப் பின்பற்றவும். கூட்டுறவு சங்கங்கள் சிறந்த பேரம் பேசும் சக்தியை வழங்குகின்றன." }, "வாழை": { "உச்ச பருவம்": "ஆண்டு முழுவதும் தேவை, ஆனால் ஓணம் பண்டிகையின் போது நேந்திரன் போன்ற குறிப்பிட்ட வகைகளுக்கு உச்சம்.", "விலை காரணிகள்": "உள்ளூர் தேவை, போக்குவரத்து செலவுகள், மற்றும் வானிலை.", "வல்லுநர் அறிவுரை": "உள்ளூர் விற்பனையாளர்களுடன் ஒப்பந்தம் செய்வது நிலையான விலையை வழங்கும். சிப்ஸ் போன்ற மதிப்பு கூட்டல் ஒரு லாபகரமான வழி." } },
        schemes: { "பிஎம்-கிசான்": { "விளக்கம்": "சிறு விவசாயிகளுக்கு ஆண்டுக்கு ₹6000 மூன்று தவணைகளில் வழங்கும் மத்திய திட்டம்.", "தகுதி": "விவசாய நிலம் உள்ள அனைத்து விவசாய குடும்பங்களும்.", "விண்ணப்பிப்பது எப்படி": "பிஎம்-கிசான் போர்டல் அல்லது பொது சேவை மையங்கள் (CSC) மூலம்." }, "விவசாயி ஓய்வூதியம்": { "விளக்கம்": "60 வயதுக்கு மேற்பட்ட விவசாயிகளுக்கான கேரள மாநில ஓய்வூதியத் திட்டம்.", "தகுதி": "2 ஹெக்டேருக்கு குறைவாக நிலம் உள்ள, வேறு எந்த ஓய்வூதியமும் பெறாத விவசாயிகள்.", "விண்ணப்பிப்பது எப்படி": "உள்ளூர் கிருஷி பவன் மூலம்." }, "சுபிக்ஷா கேரளம்": { "விளக்கம்": "விவசாய உற்பத்தியை పెంచడానికి மற்றும் உணவு தன்னிறைவை அடைய கேரள அரசு திட்டம்.", "தகுதி": "விவசாயிகள், விவசாய குழுக்கள், மற்றும் விவசாயத்தில் ஆர்வமுள்ள தனிநபர்கள். விதைகள், மானியங்கள் மற்றும் ஆதரவு வழங்குகிறது.", "விண்ணப்பிப்பது எப்படி": "குறிப்பிட்ட துணைத் திட்டங்களுக்கு உள்ளூர் கிருஷி பவனைத் தொடர்பு கொள்ளவும்." }, "RKVY": { "விளக்கம்": "ராஷ்டிரிய கிருஷி விகாஸ் யோஜனா என்பது விவசாய உள்கட்டமைப்பு மற்றும் இயந்திரமயமாக்கல் உள்ளிட்ட பல்வேறு விவசாய திட்டங்களுக்கு மாநிலங்களுக்கு நிதி வழங்கும் ஒரு மத்திய திட்டமாகும்.", "தகுதி": "திட்டத்தைப் பொறுத்து மாறுபடும்; மாநில வேளாண்மைத் துறை மூலம் செயல்படுத்தப்படுகிறது.", "விண்ணப்பிப்பது எப்படி": "விவசாய குழுக்கள் அல்லது பஞ்சாயத்துகள் மூலம் கிருஷி பவன் வழியாக முன்மொழிவுகள் சமர்ப்பிக்கப்படுகின்றன." } }
    }
};

/* ============================ State & DOM refs ============================ */
let LANG = 'en'; let FLOW = [];
const chatWindow = document.getElementById('chatWindow'), openChat = document.getElementById('openChat'), closeBtn = document.getElementById('closeBtn'), chatBody = document.getElementById('chatBody'), backBtn = document.getElementById('backBtn'), restartBtn = document.getElementById('restartBtn'), langPills = document.querySelectorAll('.lang-pill');

/* ============================ Utilities & Rendering ============================ */
function _t(key, r={}) { let s=I18N[LANG][key]||I18N.en[key]||`[${key}]`; for(const p in r){s=s.replace(`{${p}}`,r[p]);} return s; }
function escapeHtml(s) { return s ? s.replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])) : ''; }
function clearChat() { chatBody.innerHTML=''; }
function addUser(t) { const d=document.createElement('div');d.className='msg user';d.innerHTML=`<div style="font-weight:500">${escapeHtml(t)}</div>`;chatBody.appendChild(d);chatBody.scrollTop=chatBody.scrollHeight; }
function addBot(h) { const d=document.createElement('div');d.className='msg bot';d.innerHTML=h;chatBody.appendChild(d);chatBody.scrollTop=chatBody.scrollHeight; }
function addOptions(items, onSelect, note=null) {
  const wrapper=document.createElement('div');wrapper.className='msg bot';
  let inner=note?`<div style="font-weight:700;margin-bottom:12px;color:var(--bot-text);">${note}</div>`:'';
  inner+='<div class="options-grid">';
  items.forEach(it=>{ inner+=`<div class="card" data-key="${escapeHtml(it.k)}"><div class="title">${escapeHtml(it.t)}</div><div class="sub">${escapeHtml(it.s||'')}</div></div>`; });
  inner+='</div>';wrapper.innerHTML=inner;chatBody.appendChild(wrapper);chatBody.scrollTop=chatBody.scrollHeight;
  wrapper.querySelectorAll('.card').forEach(card=>{ card.addEventListener('click',()=>{ const k=card.getAttribute('data-key');onSelect(k);wrapper.querySelectorAll('.card').forEach(c=>c.style.opacity=0.5);card.style.opacity=1;card.style.borderColor='var(--accent-2)';}); });
}
function buildReport(title, data) {
    let html = `<div class="report-card"><b>${title}</b>`;
    for (const key in data) {
        if (key !== 'Resistant Varieties') {
            html += `<div class="report-line"><b>${key}</b>${data[key]}</div>`;
        }
    }
    html += `</div>`;
    addBot(html);
}

/* ============================ Core Flow & Startup ============================ */
function pushFlow(flow, selection) { FLOW.push({flow, selection}); }
openChat.addEventListener('click', ()=>{chatWindow.classList.remove('chat-hidden');resetFlow();});
closeBtn.addEventListener('click', ()=>chatWindow.classList.add('chat-hidden'));
langPills.forEach(p=>{ p.addEventListener('click', ()=>{ langPills.forEach(n=>n.classList.remove('active'));p.classList.add('active');LANG=p.getAttribute('data-lang');resetFlow();}); });

function resetFlow() {
  FLOW=[];clearChat();
  backBtn.innerHTML = _t('back_button'); restartBtn.innerHTML = _t('restart_button');
  addBot(`<b>${_t('welcome')}</b><div class="note">${_t('startPrompt')}</div>`);
  addOptions(DATA[LANG].features, startFlow);
}

/* ============================ Flow Controllers ============================ */
function startFlow(flowKey) {
    const feature = DATA[LANG].features.find(f => f.k === flowKey);
    addUser(feature.t);
    pushFlow(flowKey, feature.t);

    const flows = {
        crops: () => showAndHandleSelection('crops', (item) => { buildReport(item, DATA[LANG].crops[item]); addContextualSuggestions('crops', item); }),
        soils: () => showAndHandleSelection('soils', (item) => { buildReport(item, DATA[LANG].soils[item]); addContextualSuggestions('soils', item); }),
        fertilizers: () => showAndHandleSelection('fertilizers', (item) => { buildReport(item, DATA[LANG].fertilizers[item]); addContextualSuggestions('fertilizers', item); }),
        pests: () => showAndHandleSelection('pests', (item) => { buildReport(item, DATA[LANG].pests[item]); addContextualSuggestions('pests', item); }),
        market: () => showAndHandleSelection('market', (item) => { buildReport(item, DATA[LANG].market[item]); addContextualSuggestions('market', item); }),
        schemes: () => showAndHandleSelection('schemes', (item) => { buildReport(item, DATA[LANG].schemes[item]); addContextualSuggestions('schemes', item); }),
        weather: () => startWeatherFlow(),
    };
    if(flows[flowKey]) flows[flowKey]();
}

function showAndHandleSelection(dataType, handler) {
    addBot(`<b>${_t(`list_title_${dataType}`)}</b>`);
    const options = Object.keys(DATA[LANG][dataType]).map(key => ({ k: key, t: key }));
    addOptions(options, (selection) => {
        addUser(selection);
        pushFlow(dataType, selection);
        handler(selection);
    });
}

function addContextualSuggestions(flow, item) {
    let suggestions = [];
    switch (flow) {
        case 'crops':
            suggestions = [{k:'soils', t:_t('sugg_check_soil')}, {k:'fertilizers', t:_t('sugg_explore_fertilizers')}, {k:'pests', t:_t('sugg_lookup_pests')}, {k:'market', t:_t('sugg_see_market')}];
            break;
        case 'soils':
            suggestions = [{k:'crops', t:_t('sugg_explore_crops')}, {k:'fertilizers', t:_t('sugg_check_fertilizers')}, {k:'pests', t:_t('sugg_pests_regional')}, {k:'schemes', t:_t('sugg_schemes_land')}];
            break;
        case 'fertilizers':
             suggestions = [{k:'crops', t:_t('sugg_see_crop_guides')}, {k:'soils', t:_t('sugg_learn_about_soil')}, {k:'pests', t:_t('sugg_lookup_pests')}, {k:'schemes', t:_t('sugg_check_schemes')}];
            break;
        case 'pests':
            suggestions = [{k:'resistant_varieties', t:_t('sugg_resistant_varieties')}, {k:'weather', t:_t('sugg_check_weather')}, {k:'fertilizers', t:_t('sugg_fert_for_strength')}, {k:'crops', t:_t('sugg_see_crop_guides')}];
            break;
        case 'market':
            suggestions = [{k:'schemes', t:_t('sugg_check_schemes')}, {k:'crops', t:_t('sugg_explore_another_crop')}, {k:'weather', t:_t('sugg_check_weather')}, {k:'soils', t:_t('sugg_learn_about_soil')}];
            break;
        case 'weather':
            suggestions = [{k:'crops', t:_t('sugg_check_suitable_crops')}, {k:'pests', t:_t('sugg_lookup_pests')}, {k:'market', t:_t('sugg_market_for_season')}, {k:'soils', t:_t('sugg_soil_for_climate')}];
            break;
        default:
            suggestions = [{k:'crops', t:_t('sugg_see_crop_guides')}, {k:'soils', t:_t('sugg_learn_about_soil')}, {k:'fertilizers', t:_t('sugg_explore_fertilizers')}, {k:'market', t:_t('sugg_see_market')}];
    }
    
    addOptions(suggestions, (key) => {
        if (key === 'resistant_varieties') {
            const feature = {t: _t('sugg_resistant_varieties')};
            addUser(feature.t);
            pushFlow(key, feature.t);

            const pestData = DATA[LANG].pests[item];
            if (pestData && pestData['Resistant Varieties']) {
                const varieties = pestData['Resistant Varieties'];
                let reportHTML = `<div class="report-card"><b>${_t('list_title_resistant_varieties', {pest: item})}</b>`;
                for (const crop in varieties) {
                    reportHTML += `<div class="report-line"><b>${crop}</b>${varieties[crop].join(', ')}</div>`;
                }
                reportHTML += `</div>`;
                addBot(reportHTML);
                addOptions([{k:'crops', t:_t('sugg_see_crop_guides')}, {k:'pests', t:_t('sugg_lookup_pests')}], startFlow);
            } else {
                addBot(`No specific resistant variety data found for ${item}.`);
                addOptions([{k:'crops', t:_t('sugg_see_crop_guides')}, {k:'pests', t:_t('sugg_lookup_pests')}], startFlow);
            }
        } else {
            startFlow(key);
        }
    }, _t('next_steps_label'));
}

function startWeatherFlow() {
    // This is a dummy flow and does not use an API key
    const location = prompt(_t('weather_prompt'));
    if (location && location.trim()) {
        addUser(`Weather for ${location}`);
        pushFlow('weather', location);
        addBot(_t('weather_fetching', { location }));
        // Dummy data for demo
        const sampleData = { temp: 29, humidity: 85 };
        let advice = "<b>Analysis & Advice:</b><br>";
        if (sampleData.humidity > 80) advice += "High humidity increases the risk of fungal infections. Ensure good air circulation.";
        addBot(`<b>Report for ${location}</b><br>Temperature: ${sampleData.temp}°C, Humidity: ${sampleData.humidity}%<br><br>${advice}`);
        addContextualSuggestions('weather');
    }
}

/* ============================ Navigation ============================ */
backBtn.addEventListener('click', ()=>{
    if (FLOW.length > 1) { FLOW.pop(); const lastState = FLOW[FLOW.length - 1]; clearChat(); addBot(`<b>${_t('welcome')}</b>`); startFlow(lastState.flow); } 
    else { resetFlow(); }
});
restartBtn.addEventListener('click',()=>resetFlow());
document.addEventListener('keydown', e=>{if(e.key==='Escape')closeChatWindow();});

// Initial Start
resetFlow(true);
</script>
</body>

</html>
